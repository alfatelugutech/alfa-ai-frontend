<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Trading Platform Professional v7.0 - Backend Integrated</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <style>
        @import url('https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css');
        /* Add your existing styles here */
        .ai-pulse { animation: aiPulse 2s infinite; }
        @keyframes aiPulse { 
            0%, 100% { opacity: 1; background: linear-gradient(45deg, #10b981, #059669); transform: scale(1); } 
            50% { opacity: 0.9; background: linear-gradient(45deg, #059669, #047857); transform: scale(1.02); } 
        }
        .status-active { background: linear-gradient(45deg, #10b981, #059669); }
        .status-inactive { background: #6b7280; }
        .live-indicator { animation: livePulse 2s infinite; }
        @keyframes livePulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b sticky top-0 z-40">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="h-10 w-10 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center text-white font-bold text-lg">ü§ñ</div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900 flex items-center">
                            üöÄ AI Trading Platform Professional
                            <span class="ml-2 px-2 py-1 bg-purple-100 text-purple-700 rounded-lg text-xs">v7.0</span>
                        </h1>
                        <p class="text-xs text-gray-500">Real Backend Integration ‚Ä¢ AI Automation ‚Ä¢ Paper Trading ‚Ä¢ Live API</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2" id="ai-status-indicator">
                        <div class="w-3 h-3 rounded-full status-inactive" id="ai-status-dot"></div>
                        <span class="text-sm font-medium" id="ai-status-text">AI Inactive</span>
                        <span class="text-xs bg-gray-100 px-2 py-1 rounded" id="ai-trades-counter">0 trades</span>
                    </div>
                    
                    <div class="flex items-center space-x-2" id="backend-status">
                        <div class="w-2 h-2 rounded-full bg-red-500" id="backend-indicator"></div>
                        <span class="text-xs text-gray-600" id="backend-status-text">Connecting...</span>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 rounded-full bg-green-500 live-indicator"></div>
                        <span class="text-xs text-gray-600" id="current-time"></span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto py-6 px-4">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            
            <!-- Left Sidebar -->
            <aside class="lg:col-span-1 space-y-6">
                <!-- AI Control Panel -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-gray-900">ü§ñ AI Control</h3>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 rounded-full status-inactive" id="ai-control-indicator"></div>
                            <span class="text-xs font-medium" id="ai-control-status">Inactive</span>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <button class="w-full px-4 py-3 rounded-lg text-sm font-medium transition-all bg-green-600 text-white hover:bg-green-700" id="start-ai-btn" onclick="startAITrading()">
                            üöÄ Start AI Trading
                        </button>
                        <button class="w-full px-4 py-3 rounded-lg text-sm font-medium transition-all bg-red-600 text-white hover:bg-red-700 opacity-50 cursor-not-allowed" id="stop-ai-btn" onclick="stopAITrading()" disabled>
                            üõë Stop AI Trading
                        </button>
                        <div class="text-xs text-gray-600 p-3 bg-gray-50 rounded" id="ai-status-details">
                            Ready for paper trading! Click Start to begin.
                        </div>
                    </div>
                </div>

                <!-- Account Summary -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="font-semibold mb-4 text-gray-900">üí∞ Paper Account</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Available:</span>
                            <span class="font-medium" id="available-balance">‚Çπ10,00,000</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Invested:</span>
                            <span class="font-medium" id="invested-amount">‚Çπ0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">P&L:</span>
                            <span class="font-medium" id="total-pnl">‚Çπ0</span>
                        </div>
                        <div class="border-t pt-2 mt-2">
                            <div class="flex justify-between">
                                <span class="text-gray-800 font-medium">Total Value:</span>
                                <span class="font-bold" id="total-value">‚Çπ10,00,000</span>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="lg:col-span-2 space-y-6">
                <!-- AI Trading Dashboard -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-semibold flex items-center">
                            ü§ñ AI Trading Dashboard
                            <span class="ml-2 w-3 h-3 rounded-full status-inactive" id="ai-dashboard-indicator"></span>
                        </h3>
                        <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm" onclick="refreshData()">
                            üîÑ Refresh
                        </button>
                    </div>

                    <!-- AI Performance Metrics -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="p-4 bg-green-50 rounded-xl text-center">
                            <div class="text-2xl font-bold text-green-600" id="ai-profit-total">‚Çπ0</div>
                            <div class="text-sm text-green-600">Total Profit</div>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-xl text-center">
                            <div class="text-2xl font-bold text-blue-600" id="ai-trades-today">0</div>
                            <div class="text-sm text-blue-600">Total Trades</div>
                        </div>
                        <div class="p-4 bg-purple-50 rounded-xl text-center">
                            <div class="text-2xl font-bold text-purple-600" id="ai-win-rate">0%</div>
                            <div class="text-sm text-purple-600">Success Rate</div>
                        </div>
                        <div class="p-4 bg-orange-50 rounded-xl text-center">
                            <div class="text-2xl font-bold text-orange-600" id="backend-response-time">--ms</div>
                            <div class="text-sm text-orange-600">API Response</div>
                        </div>
                    </div>

                    <!-- Live AI Status -->
                    <div class="p-4 rounded-xl mb-6 bg-gray-100 text-gray-800" id="ai-status-banner">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-4 h-4 rounded-full status-inactive" id="ai-banner-indicator"></div>
                                <div>
                                    <h4 class="font-semibold" id="ai-banner-title">ü§ñ AI Trading Ready</h4>
                                    <p class="text-sm opacity-90" id="ai-banner-desc">Backend connected! Click Start to begin automated trading.</p>
                                </div>
                            </div>
                            <button class="px-4 py-2 bg-white bg-opacity-20 rounded-lg text-sm font-medium hover:bg-opacity-30 transition-all" id="ai-toggle-btn" onclick="toggleAITrading()">
                                Start AI
                            </button>
                        </div>
                    </div>

                    <!-- Live Trades Table -->
                    <div>
                        <h4 class="font-medium mb-4 flex items-center">
                            üìà Live Trades
                            <span class="ml-2 text-xs bg-green-100 px-2 py-1 rounded">Real Backend Data</span>
                        </h4>
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse border border-gray-300">
                                <thead>
                                    <tr class="bg-gray-50">
                                        <th class="border border-gray-300 px-4 py-2 text-left">Symbol</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Side</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Quantity</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Price</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Strategy</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Time</th>
                                    </tr>
                                </thead>
                                <tbody id="trades-table-body">
                                    <tr>
                                        <td colspan="6" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                                            No trades yet. Start AI trading to see live data from backend.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Manual Trading -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-6">‚ö° Manual Trading</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Buy Order -->
                        <div class="p-4 bg-green-50 rounded-xl">
                            <h4 class="font-medium text-green-800 mb-4">üìà Buy Order</h4>
                            <div class="space-y-3">
                                <input class="w-full px-3 py-2 border rounded-lg text-sm" id="buy-symbol" placeholder="Symbol (e.g., RELIANCE)" type="text">
                                <input class="w-full px-3 py-2 border rounded-lg text-sm" id="buy-quantity" placeholder="Quantity" type="number">
                                <input class="w-full px-3 py-2 border rounded-lg text-sm" id="buy-price" placeholder="Price" step="0.01" type="number">
                                <button class="w-full px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium" onclick="placeOrder('BUY')">
                                    Place Buy Order
                                </button>
                            </div>
                        </div>

                        <!-- Sell Order -->
                        <div class="p-4 bg-red-50 rounded-xl">
                            <h4 class="font-medium text-red-800 mb-4">üìâ Sell Order</h4>
                            <div class="space-y-3">
                                <input class="w-full px-3 py-2 border rounded-lg text-sm" id="sell-symbol" placeholder="Symbol (e.g., RELIANCE)" type="text">
                                <input class="w-full px-3 py-2 border rounded-lg text-sm" id="sell-quantity" placeholder="Quantity" type="number">
                                <input class="w-full px-3 py-2 border rounded-lg text-sm" id="sell-price" placeholder="Price" step="0.01" type="number">
                                <button class="w-full px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm font-medium" onclick="placeOrder('SELL')">
                                    Place Sell Order
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar -->
            <aside class="lg:col-span-1 space-y-6">
                <!-- Backend Connection Status -->
                <div class="bg-white rounded-2xl shadow-lg p-4">
                    <h3 class="font-semibold mb-4 text-gray-900">üîå Backend Status</h3>
                    <div class="space-y-2 text-sm" id="backend-connection-status">
                        <div class="flex justify-between">
                            <span>Status:</span>
                            <span id="connection-status">Connecting...</span>
                        </div>
                        <div class="flex justify-between">
                            <span>API URL:</span>
                            <span class="text-xs" id="api-url">Loading...</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Last Sync:</span>
                            <span id="last-sync">Never</span>
                        </div>
                    </div>
                </div>

                <!-- Live Updates -->
                <div class="bg-white rounded-2xl shadow-lg p-4">
                    <h3 class="font-semibold mb-4 text-gray-900 flex items-center">
                        üì° Live Updates
                        <span class="ml-2 w-2 h-2 bg-green-500 rounded-full live-indicator"></span>
                    </h3>
                    <div class="space-y-3 text-xs max-h-64 overflow-y-auto" id="live-updates">
                        <div class="p-2 bg-blue-50 rounded border-l-2 border-blue-500">
                            <div class="font-medium text-blue-800">System Starting</div>
                            <div class="text-blue-600">Connecting to backend API...</div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'https://alfa-ai-backend-it8a.onrender.com'; // Your deployed backend URL
        let isAIActive = false;
        let dataRefreshInterval = null;
        let backendConnected = false;

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            
            // Test backend connection
            testBackendConnection();
            
            // Start data refresh cycle
            startDataRefresh();
            
            showNotification('info', 'üöÄ AI Trading Platform v7.0 Starting...');
        });

        // Time management
        function updateTime() {
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = new Date().toLocaleTimeString();
            }
        }

        // Backend Connection Management
        async function testBackendConnection() {
            try {
                const startTime = Date.now();
                const response = await fetch(`${API_BASE_URL}/api/health`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const responseTime = Date.now() - startTime;
                
                if (response.ok) {
                    const data = await response.json();
                    backendConnected = true;
                    updateBackendStatus(true, responseTime);
                    showNotification('success', '‚úÖ Backend connected successfully!');
                    loadInitialData();
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.error('Backend connection failed:', error);
                backendConnected = false;
                updateBackendStatus(false, 0);
                showNotification('error', '‚ùå Backend connection failed. Using offline mode.');
            }
        }

        function updateBackendStatus(connected, responseTime = 0) {
            const indicator = document.getElementById('backend-indicator');
            const statusText = document.getElementById('backend-status-text');
            const connectionStatus = document.getElementById('connection-status');
            const apiUrlElement = document.getElementById('api-url');
            const responseTimeElement = document.getElementById('backend-response-time');
            
            if (connected) {
                if (indicator) indicator.className = 'w-2 h-2 rounded-full bg-green-500 live-indicator';
                if (statusText) statusText.textContent = 'Connected';
                if (connectionStatus) connectionStatus.textContent = 'Connected';
                if (responseTimeElement) responseTimeElement.textContent = `${responseTime}ms`;
            } else {
                if (indicator) indicator.className = 'w-2 h-2 rounded-full bg-red-500';
                if (statusText) statusText.textContent = 'Disconnected';
                if (connectionStatus) connectionStatus.textContent = 'Disconnected';
                if (responseTimeElement) responseTimeElement.textContent = '--ms';
            }
            
            if (apiUrlElement) apiUrlElement.textContent = API_BASE_URL;
        }

        // Data Loading Functions
        async function loadInitialData() {
            if (!backendConnected) return;
            
            try {
                // Load paper account
                await loadPaperAccount();
                
                // Load AI settings to check if AI is active
                await loadAIStatus();
                
                // Load trades
                await loadTrades();
                
                updateElement('last-sync', new Date().toLocaleTimeString());
                showNotification('success', 'üìä Data loaded from backend');
                
            } catch (error) {
                console.error('Error loading initial data:', error);
                showNotification('error', '‚ùå Failed to load data from backend');
            }
        }

        async function loadPaperAccount() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/paper-account`);
                if (response.ok) {
                    const data = await response.json();
                    const account = data.account;
                    
                    updateElement('available-balance', `‚Çπ${account.balance.toLocaleString()}`);
                    updateElement('invested-amount', `‚Çπ${account.invested.toLocaleString()}`);
                    updateElement('total-pnl', `‚Çπ${account.pnl.toLocaleString()}`);
                    updateElement('total-value', `‚Çπ${account.total_value.toLocaleString()}`);
                }
            } catch (error) {
                console.error('Error loading paper account:', error);
            }
        }

        async function loadAIStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/ai-trading/settings`);
                if (response.ok) {
                    const data = await response.json();
                    isAIActive = data.settings.is_active;
                    updateAIStatusUI(isAIActive);
                }
            } catch (error) {
                console.error('Error loading AI status:', error);
            }
        }

        async function loadTrades() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/trades`);
                if (response.ok) {
                    const data = await response.json();
                    updateTradesTable(data.trades);
                    updateElement('ai-trades-today', data.count);
                }
            } catch (error) {
                console.error('Error loading trades:', error);
            }
        }

        function updateTradesTable(trades) {
            const tbody = document.getElementById('trades-table-body');
            if (!tbody) return;
            
            if (!trades || trades.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                            No trades yet. Start AI trading to see live data from backend.
                        </td>
                    </tr>
                `;
                return;
            }
            
            const tradesHtml = trades.slice(0, 10).map(trade => `
                <tr class="hover:bg-gray-50">
                    <td class="border border-gray-300 px-4 py-2">${trade[2]}</td>
                    <td class="border border-gray-300 px-4 py-2">
                        <span class="px-2 py-1 rounded text-xs ${trade[3] === 'BUY' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${trade[3]}
                        </span>
                    </td>
                    <td class="border border-gray-300 px-4 py-2">${trade[4]}</td>
                    <td class="border border-gray-300 px-4 py-2">‚Çπ${parseFloat(trade[5]).toFixed(2)}</td>
                    <td class="border border-gray-300 px-4 py-2">
                        <span class="px-2 py-1 rounded text-xs ${trade[8] === 'AI_AUTO' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'}">
                            ${trade[8] === 'AI_AUTO' ? 'ü§ñ AI' : 'üë§ Manual'}
                        </span>
                    </td>
                    <td class="border border-gray-300 px-4 py-2 text-xs text-gray-600">
                        ${new Date(trade[10]).toLocaleTimeString()}
                    </td>
                </tr>
            `).join('');
            
            tbody.innerHTML = tradesHtml;
        }

        // AI Trading Controls
        async function startAITrading() {
            if (!backendConnected) {
                showNotification('error', '‚ùå Backend not connected. Cannot start AI trading.');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/ai-trading/start`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    isAIActive = true;
                    updateAIStatusUI(true);
                    showNotification('success', data.message);
                    addLiveUpdate('ü§ñ AI Trading Started', 'Backend confirmed AI trading is now active');
                } else {
                    throw new Error('Failed to start AI trading');
                }
            } catch (error) {
                console.error('Error starting AI trading:', error);
                showNotification('error', '‚ùå Failed to start AI trading');
            }
        }

        async function stopAITrading() {
            if (!backendConnected) {
                showNotification('error', '‚ùå Backend not connected');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/ai-trading/stop`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    isAIActive = false;
                    updateAIStatusUI(false);
                    showNotification('success', data.message);
                    addLiveUpdate('üõë AI Trading Stopped', 'Backend confirmed AI trading is now inactive');
                } else {
                    throw new Error('Failed to stop AI trading');
                }
            } catch (error) {
                console.error('Error stopping AI trading:', error);
                showNotification('error', '‚ùå Failed to stop AI trading');
            }
        }

        function toggleAITrading() {
            if (isAIActive) {
                stopAITrading();
            } else {
                startAITrading();
            }
        }

        function updateAIStatusUI(active) {
            const elements = {
                statusText: document.getElementById('ai-status-text'),
                statusDot: document.getElementById('ai-status-dot'),
                controlIndicator: document.getElementById('ai-control-indicator'),
                controlStatus: document.getElementById('ai-control-status'),
                dashboardIndicator: document.getElementById('ai-dashboard-indicator'),
                bannerIndicator: document.getElementById('ai-banner-indicator'),
                bannerTitle: document.getElementById('ai-banner-title'),
                bannerDesc: document.getElementById('ai-banner-desc'),
                toggleBtn: document.getElementById('ai-toggle-btn'),
                statusDetails: document.getElementById('ai-status-details'),
                startBtn: document.getElementById('start-ai-btn'),
                stopBtn: document.getElementById('stop-ai-btn')
            };
            
            if (active) {
                // Update status indicators
                if (elements.statusText) elements.statusText.textContent = 'AI Active';
                if (elements.controlStatus) elements.controlStatus.textContent = 'Active';
                if (elements.statusDot) elements.statusDot.className = 'w-3 h-3 rounded-full status-active ai-pulse';
                if (elements.controlIndicator) elements.controlIndicator.className = 'w-2 h-2 rounded-full status-active live-indicator';
                if (elements.dashboardIndicator) elements.dashboardIndicator.className = 'w-3 h-3 rounded-full status-active live-indicator';
                if (elements.bannerIndicator) elements.bannerIndicator.className = 'w-4 h-4 rounded-full status-active live-indicator';
                
                if (elements.bannerTitle) elements.bannerTitle.textContent = 'ü§ñ AI Trading Active';
                if (elements.bannerDesc) elements.bannerDesc.textContent = 'AI is actively trading on the backend with paper money';
                if (elements.toggleBtn) elements.toggleBtn.textContent = 'Stop AI';
                if (elements.statusDetails) elements.statusDetails.textContent = 'AI is actively analyzing markets and executing trades via backend API';
                
                // Update buttons
                if (elements.startBtn) {
                    elements.startBtn.disabled = true;
                    elements.startBtn.className = 'w-full px-4 py-3 rounded-lg text-sm font-medium transition-all bg-gray-400 text-white cursor-not-allowed';
                }
                if (elements.stopBtn) {
                    elements.stopBtn.disabled = false;
                    elements.stopBtn.className = 'w-full px-4 py-3 rounded-lg text-sm font-medium transition-all bg-red-600 text-white hover:bg-red-700';
                }
                
                // Update banner background
                const banner = document.getElementById('ai-status-banner');
                if (banner) banner.className = 'p-4 rounded-xl mb-6 bg-green-100 text-green-800';
                
            } else {
                // Update status indicators
                if (elements.statusText) elements.statusText.textContent = 'AI Inactive';
                if (elements.controlStatus) elements.controlStatus.textContent = 'Inactive';
                if (elements.statusDot) elements.statusDot.className = 'w-3 h-3 rounded-full status-inactive';
                if (elements.controlIndicator) elements.controlIndicator.className = 'w-2 h-2 rounded-full status-inactive';
                if (elements.dashboardIndicator) elements.dashboardIndicator.className = 'w-3 h-3 rounded-full status-inactive';
                if (elements.bannerIndicator) elements.bannerIndicator.className = 'w-4 h-4 rounded-full status-inactive';
                
                if (elements.bannerTitle) elements.bannerTitle.textContent = 'ü§ñ AI Trading Ready';
                if (elements.bannerDesc) elements.bannerDesc.textContent = 'Backend connected! Click Start to begin automated trading.';
                if (elements.toggleBtn) elements.toggleBtn.textContent = 'Start AI';
                if (elements.statusDetails) elements.statusDetails.textContent = 'Ready for paper trading! Click Start to begin.';
                
                // Update buttons
                if (elements.startBtn) {
                    elements.startBtn.disabled = false;
                    elements.startBtn.className = 'w-full px-4 py-3 rounded-lg text-sm font-medium transition-all bg-green-600 text-white hover:bg-green-700';
                }
                if (elements.stopBtn) {
                    elements.stopBtn.disabled = true;
                    elements.stopBtn.className = 'w-full px-4 py-3 rounded-lg text-sm font-medium transition-all bg-red-600 text-white opacity-50 cursor-not-allowed';
                }
                
                // Update banner background
                const banner = document.getElementById('ai-status-banner');
                if (banner) banner.className = 'p-4 rounded-xl mb-6 bg-gray-100 text-gray-800';
            }
        }

        // Manual Trading
        async function placeOrder(side) {
            if (!backendConnected) {
                showNotification('error', '‚ùå Backend not connected');
                return;
            }
            
            const symbol = document.getElementById(`${side.toLowerCase()}-symbol`)?.value;
            const quantity = parseInt(document.getElementById(`${side.toLowerCase()}-quantity`)?.value);
            const price = parseFloat(document.getElementById(`${side.toLowerCase()}-price`)?.value);
            
            if (!symbol || !quantity || !price) {
                showNotification('error', '‚ùå Please fill all fields');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/place-order`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        symbol: symbol.toUpperCase(),
                        side: side,
                        quantity: quantity,
                        price: price,
                        account_type: 'paper'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showNotification('success', `‚úÖ ${side} order placed: ${quantity} ${symbol} at ‚Çπ${price}`);
                    
                    // Clear form
                    document.getElementById(`${side.toLowerCase()}-symbol`).value = '';
                    document.getElementById(`${side.toLowerCase()}-quantity`).value = '';
                    document.getElementById(`${side.toLowerCase()}-price`).value = '';
                    
                    // Refresh data
                    setTimeout(() => {
                        loadTrades();
                        loadPaperAccount();
                    }, 1000);
                    
                    addLiveUpdate(`üìà Manual Trade`, `${side} ${quantity} ${symbol} at ‚Çπ${price}`);
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to place order');
                }
            } catch (error) {
                console.error('Error placing order:', error);
                showNotification('error', `‚ùå Failed to place order: ${error.message}`);
            }
        }

        // Data Refresh
        function startDataRefresh() {
            if (dataRefreshInterval) clearInterval(dataRefreshInterval);
            
            dataRefreshInterval = setInterval(() => {
                if (backendConnected) {
                    loadTrades();
                    loadPaperAccount();
                    updateElement('last-sync', new Date().toLocaleTimeString());
                }
            }, 5000); // Refresh every 5 seconds
        }

        async function refreshData() {
            if (!backendConnected) {
                await testBackendConnection();
            }
            
            if (backendConnected) {
                await loadInitialData();
                showNotification('success', 'üîÑ Data refreshed from backend');
            } else {
                showNotification('error', '‚ùå Cannot refresh - backend not connected');
            }
        }

        // Utility Functions
        function updateElement(id, content) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = content;
            }
        }

        function addLiveUpdate(title, description) {
            const container = document.getElementById('live-updates');
            if (!container) return;
            
            const updateDiv = document.createElement('div');
            updateDiv.className = 'p-2 bg-green-50 rounded border-l-2 border-green-500';
            updateDiv.innerHTML = `
                <div class="font-medium text-green-800">${title}</div>
                <div class="text-green-600">${description}</div>
                <div class="text-gray-500 text-xs">${new Date().toLocaleTimeString()}</div>
            `;
            
            container.insertBefore(updateDiv, container.firstChild);
            
            // Keep only last 10 updates
            while (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
        }

        // Notification system
        function showNotification(type, message) {
            const colors = {
                'success': 'bg-green-100 text-green-800 border-green-200',
                'error': 'bg-red-100 text-red-800 border-red-200',
                'warning': 'bg-yellow-100 text-yellow-800 border-yellow-200',
                'info': 'bg-blue-100 text-blue-800 border-blue-200'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg border z-50 ${colors[type]} max-w-sm shadow-lg`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span class="text-sm font-medium">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-gray-500 hover:text-gray-700 font-bold">√ó</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.parentElement.removeChild(notification);
                }
            }, 5000);
        }
    </script>
</body>
</html>
