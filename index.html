<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Trading Platform Professional v7.0 - Complete Trading System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <style>
        @import url('https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css');
        
        /* Enhanced Performance Optimizations */
        * { box-sizing: border-box; }
        .performance-optimized { will-change: transform; transform: translateZ(0); }
        
        /* Enhanced Desktop Layout */
        .desktop-container { min-width: 1200px; max-width: 1920px; margin: 0 auto; }
        .desktop-grid { display: grid; grid-template-columns: 320px 1fr 340px; gap: 20px; min-height: calc(100vh - 80px); }
        .main-content { min-height: 800px; overflow-y: auto; }
        .sidebar { position: sticky; top: 20px; height: fit-content; max-height: calc(100vh - 100px); overflow-y: auto; }
        
        /* Enhanced AI Trading Animations */
        .ai-pulse { animation: aiPulse 2s infinite; }
        @keyframes aiPulse { 
            0%, 100% { opacity: 1; background: linear-gradient(45deg, #10b981, #059669); transform: scale(1); } 
            50% { opacity: 0.9; background: linear-gradient(45deg, #059669, #047857); transform: scale(1.02); } 
        }
        .ai-glow { 
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.5), 0 0 60px rgba(16, 185, 129, 0.3);
            animation: glowPulse 3s infinite;
        }
        @keyframes glowPulse {
            0%, 100% { box-shadow: 0 0 30px rgba(16, 185, 129, 0.5), 0 0 60px rgba(16, 185, 129, 0.3); }
            50% { box-shadow: 0 0 40px rgba(16, 185, 129, 0.7), 0 0 80px rgba(16, 185, 129, 0.4); }
        }
        
        /* Enhanced Status Indicators */
        .status-active { background: linear-gradient(45deg, #10b981, #059669); }
        .status-inactive { background: #6b7280; }
        .status-error { background: linear-gradient(45deg, #ef4444, #dc2626); }
        .status-warning { background: linear-gradient(45deg, #f59e0b, #d97706); }
        
        /* Broker Integration Styles */
        .broker-card { 
            background: linear-gradient(135deg, #fff 0%, #f8fafc 100%); 
            border: 2px solid #e2e8f0; 
            transition: all 0.3s ease; 
        }
        .broker-card.connected { 
            border-color: #10b981; 
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); 
        }
        .broker-card.error { 
            border-color: #ef4444; 
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); 
        }
        
        /* Enhanced Trade Cards */
        .trade-card { 
            background: linear-gradient(135deg, #fff 0%, #f8fafc 100%); 
            border: 1px solid #e2e8f0; 
            transition: all 0.3s ease; 
        }
        .trade-card:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
            border-color: #3b82f6; 
        }
        
        /* AI Trading Status Cards */
        .ai-trade-card { 
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); 
            border-left: 4px solid #10b981; 
        }
        .manual-trade-card { 
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); 
            border-left: 4px solid #3b82f6; 
        }
        
        /* Enhanced Animations */
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .animate-bounce { animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8,0,1,1); } 50% { transform: none; animation-timing-function: cubic-bezier(0,0,0.2,1); } }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .ai-gradient { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .hover-scale:hover { transform: scale(1.02); transition: transform 0.2s ease; }
        .notification-enter { animation: slideInRight 0.3s ease-out; }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .glow-effect { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
        .live-indicator { animation: livePulse 2s infinite; }
        @keyframes livePulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        
        /* Tab System */
        .tab-button { transition: all 0.3s ease; border-radius: 8px; }
        .tab-button.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        .tab-content { display: none; animation: fadeIn 0.3s ease-in; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Account Type Styles */
        .paper-badge { background: linear-gradient(45deg, #10b981, #059669); }
        .live-badge { background: linear-gradient(45deg, #dc2626, #b91c1c); }
        .ai-badge { background: linear-gradient(45deg, #8b5cf6, #7c3aed); }
        
        /* Loading States */
        .skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: loading 1.5s infinite; }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        
        /* Enhanced Profit/Loss Display */
        .profit-positive { color: #059669; background: linear-gradient(90deg, #ecfdf5, #f0fdf4); }
        .profit-negative { color: #dc2626; background: linear-gradient(90deg, #fef2f2, #fef2f2); }
        
        /* Modern Card Shadows */
        .modern-card { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .modern-card:hover { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        
        /* AI Signal Styles */
        .signal-buy { border-left: 4px solid #10b981; background: linear-gradient(90deg, #ecfdf5, #f0fdf4); }
        .signal-sell { border-left: 4px solid #ef4444; background: linear-gradient(90deg, #fef2f2, #fef2f2); }
        .signal-hold { border-left: 4px solid #f59e0b; background: linear-gradient(90deg, #fffbeb, #fefce8); }
        
        /* Scrollbar Styling */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Connection Status */
        .connection-active { 
            background: linear-gradient(45deg, #10b981, #059669);
            animation: connectionPulse 2s infinite;
        }
        .connection-inactive { background: #6b7280; }
        .connection-error { 
            background: linear-gradient(45deg, #ef4444, #dc2626);
            animation: errorPulse 1s infinite;
        }
        
        @keyframes connectionPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes errorPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .desktop-grid { grid-template-columns: 280px 1fr 300px; gap: 15px; }
            .desktop-container { min-width: auto; padding: 0 15px; }
        }
        
        @media (max-width: 968px) {
            .desktop-grid { grid-template-columns: 1fr; gap: 20px; }
            .sidebar { position: static; height: auto; max-height: none; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Enhanced Header with Real-time Status -->
    <header class="bg-white shadow-lg border-b sticky top-0 z-40 performance-optimized">
        <div class="desktop-container px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="h-10 w-10 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center text-white font-bold text-lg">ü§ñ</div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900 flex items-center">
                            üöÄ AI Trading Platform Professional
                            <span class="ml-2 px-2 py-1 bg-purple-100 text-purple-700 rounded-lg text-xs">v7.0</span>
                        </h1>
                        <p class="text-xs text-gray-500">Complete Trading System ‚Ä¢ Paper Trading Ready ‚Ä¢ AI Automation ‚Ä¢ Live Analytics</p>
                    </div>
                </div>
                
                <!-- Enhanced AI Trading Status & Controls -->
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2" id="ai-status-indicator">
                        <div class="w-3 h-3 rounded-full status-inactive" id="ai-status-dot"></div>
                        <span class="text-sm font-medium" id="ai-status-text">AI Inactive</span>
                        <span class="text-xs bg-gray-100 px-2 py-1 rounded" id="ai-trades-counter">0 trades</span>
                    </div>
                    
                    <!-- Broker Connection Status -->
                    <div class="flex items-center space-x-2" id="broker-status">
                        <div class="w-2 h-2 rounded-full connection-inactive" id="broker-indicator"></div>
                        <span class="text-xs text-gray-600" id="broker-status-text">Paper Mode</span>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <button class="px-3 py-1 rounded-lg text-xs font-medium transition-all paper-badge text-white" id="paper-mode-btn" onclick="switchAccountType('paper')">
                            üìù Paper
                        </button>
                        <button class="px-3 py-1 rounded-lg text-xs font-medium transition-all bg-gray-200 text-gray-700 hover:bg-gray-300" id="live-mode-btn" onclick="switchAccountType('live')">
                            üî¥ Live
                        </button>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 rounded-full bg-green-500 live-indicator"></div>
                        <span class="text-xs text-gray-600" id="current-time"></span>
                    </div>
                    
                    <button class="relative p-2 text-gray-600 hover:text-gray-900 transition-all" onclick="toggleNotifications()">
                        üîî
                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center" id="notification-count">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="desktop-container py-6">
        <div class="desktop-grid">
            <!-- Left Sidebar - Navigation & AI Controls -->
            <aside class="sidebar space-y-6">
                <!-- Navigation Tabs -->
                <div class="bg-white rounded-2xl shadow-lg p-4 modern-card">
                    <h3 class="font-semibold mb-4 text-gray-900">üéõÔ∏è Dashboard</h3>
                    <div class="space-y-2">
                        <button class="tab-button w-full text-left px-3 py-2 rounded-lg text-sm active" onclick="switchTab('ai-trading')">
                            ü§ñ AI Trading Hub
                        </button>
                        <button class="tab-button w-full text-left px-3 py-2 rounded-lg text-sm" onclick="switchTab('broker-setup')">
                            üîó Broker Setup
                        </button>
                        <button class="tab-button w-full text-left px-3 py-2 rounded-lg text-sm" onclick="switchTab('overview')">
                            üìà Market Overview
                        </button>
                        <button class="tab-button w-full text-left px-3 py-2 rounded-lg text-sm" onclick="switchTab('trading')">
                            ‚ö° Manual Trading
                        </button>
                        <button class="tab-button w-full text-left px-3 py-2 rounded-lg text-sm" onclick="switchTab('portfolio')">
                            üíº Portfolio & P&L
                        </button>
                        <button class="tab-button w-full text-left px-3 py-2 rounded-lg text-sm" onclick="switchTab('reports')">
                            üìä Trade Reports
                        </button>
                        <button class="tab-button w-full text-left px-3 py-2 rounded-lg text-sm" onclick="switchTab('capital')">
                            üí∞ Capital Management
                        </button>
                        <button class="tab-button w-full text-left px-3 py-2 rounded-lg text-sm" onclick="switchTab('settings')">
                            ‚öôÔ∏è Settings
                        </button>
                    </div>
                </div>

                <!-- Enhanced AI Trading Quick Controls -->
                <div class="bg-white rounded-2xl shadow-lg p-4 modern-card" id="ai-quick-controls">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-gray-900">ü§ñ AI Control</h3>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 rounded-full status-inactive" id="ai-control-indicator"></div>
                            <span class="text-xs font-medium" id="ai-control-status">Inactive</span>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <button class="w-full px-3 py-2 rounded-lg text-sm font-medium transition-all ai-gradient text-white hover:ai-glow" id="start-ai-btn" onclick="handleStartAI()">
                            üöÄ Start AI Trading
                        </button>
                        <button class="w-full px-3 py-2 rounded-lg text-sm font-medium transition-all bg-gray-400 text-white cursor-not-allowed" id="stop-ai-btn" onclick="handleStopAI()" disabled>
                            üõë Stop AI Trading
                        </button>
                        <div class="text-xs text-gray-600 p-2 bg-gray-50 rounded" id="ai-status-details">
                            Ready for paper trading! Click Start to begin.
                        </div>
                        <div class="text-xs text-center" id="ai-last-action">
                            No recent AI activity
                        </div>
                    </div>
                </div>

                <!-- Enhanced Account Summary -->
                <div class="bg-white rounded-2xl shadow-lg p-4 modern-card" id="account-summary">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-gray-900">üí∞ Account</h3>
                        <span class="text-xs px-2 py-1 rounded-full bg-green-100 text-green-700" id="account-type-badge">Paper</span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Available:</span>
                            <span class="font-medium" id="available-balance">‚Çπ10,00,000</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Invested:</span>
                            <span class="font-medium" id="invested-amount">‚Çπ0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">P&L:</span>
                            <span class="font-medium" id="total-pnl">‚Çπ0</span>
                        </div>
                        <div class="border-t pt-2 mt-2">
                            <div class="flex justify-between">
                                <span class="text-gray-800 font-medium">Total Value:</span>
                                <span class="font-bold" id="total-value">‚Çπ10,00,000</span>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 mt-2">
                            <div class="flex justify-between">
                                <span>Today's P&L:</span>
                                <span id="daily-pnl">‚Çπ0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Quick Stats -->
                <div class="bg-white rounded-2xl shadow-lg p-4 modern-card">
                    <h3 class="font-semibold mb-4 text-gray-900">üìä Live Stats</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="text-center p-3 bg-blue-50 rounded-lg hover-scale cursor-pointer" onclick="switchTab('portfolio')">
                            <div class="text-lg font-bold text-blue-600" id="positions-count">0</div>
                            <div class="text-xs text-blue-600">Positions</div>
                        </div>
                        <div class="text-center p-3 bg-green-50 rounded-lg hover-scale cursor-pointer" onclick="switchTab('reports')">
                            <div class="text-lg font-bold text-green-600" id="trades-count">0</div>
                            <div class="text-xs text-green-600">Total Trades</div>
                        </div>
                        <div class="text-center p-3 bg-purple-50 rounded-lg hover-scale cursor-pointer">
                            <div class="text-lg font-bold text-purple-600" id="ai-trades-count">0</div>
                            <div class="text-xs text-purple-600">AI Trades</div>
                        </div>
                        <div class="text-center p-3 bg-orange-50 rounded-lg hover-scale cursor-pointer">
                            <div class="text-lg font-bold text-orange-600" id="api-status">Paper Mode</div>
                            <div class="text-xs text-orange-600">Trading Mode</div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="main-content custom-scrollbar">
                <!-- AI Trading Hub Tab -->
                <div class="tab-content active space-y-6" id="tab-ai-trading">
                    <!-- AI Trading Dashboard -->
                    <div class="bg-white rounded-2xl shadow-lg p-6 modern-card">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-semibold flex items-center">
                                ü§ñ AI Trading Hub
                                <span class="ml-2 w-3 h-3 rounded-full status-inactive" id="ai-dashboard-indicator"></span>
                            </h3>
                            <div class="flex items-center space-x-3">
                                <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm" onclick="refreshAIData()">
                                    üîÑ Refresh Data
                                </button>
                                <button class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm" onclick="switchTab('settings')">
                                    ‚öôÔ∏è AI Settings
                                </button>
                            </div>
                        </div>

                        <!-- Enhanced AI Status Banner -->
                        <div class="p-4 rounded-xl mb-6 bg-gray-100 text-gray-800" id="ai-status-banner">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-4 h-4 rounded-full status-inactive" id="ai-banner-indicator"></div>
                                    <div>
                                        <h4 class="font-semibold" id="ai-banner-title">ü§ñ AI Trading Ready</h4>
                                        <p class="text-sm opacity-90" id="ai-banner-desc">Paper trading is ready! Click Start to begin automated trading with virtual money.</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <div class="text-right text-sm" id="ai-performance-summary">
                                        <div class="font-medium">Performance</div>
                                        <div class="text-xs opacity-80" id="ai-success-rate">Success Rate: --</div>
                                    </div>
                                    <button class="px-4 py-2 bg-white bg-opacity-20 rounded-lg text-sm font-medium hover:bg-opacity-30 transition-all" id="ai-toggle-btn" onclick="toggleAITrading()">
                                        Start AI
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- AI Performance Metrics -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div class="p-4 bg-green-50 rounded-xl text-center">
                                <div class="text-2xl font-bold text-green-600" id="ai-profit-total">‚Çπ0</div>
                                <div class="text-sm text-green-600">AI Profit Today</div>
                            </div>
                            <div class="p-4 bg-blue-50 rounded-xl text-center">
                                <div class="text-2xl font-bold text-blue-600" id="ai-trades-today">0</div>
                                <div class="text-sm text-blue-600">Trades Today</div>
                            </div>
                            <div class="p-4 bg-purple-50 rounded-xl text-center">
                                <div class="text-2xl font-bold text-purple-600" id="ai-win-rate">0%</div>
                                <div class="text-sm text-purple-600">Win Rate</div>
                            </div>
                            <div class="p-4 bg-orange-50 rounded-xl text-center">
                                <div class="text-2xl font-bold text-orange-600" id="ai-avg-return">0%</div>
                                <div class="text-sm text-orange-600">Avg Return</div>
                            </div>
                        </div>

                        <!-- AI Settings Quick Config -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="p-4 bg-gray-50 rounded-xl">
                                <h5 class="font-medium mb-3">üéØ Trading Mode</h5>
                                <select class="w-full px-3 py-2 border rounded-lg text-sm" id="ai-trading-mode" onchange="updateAISetting('trading_mode', this.value)">
                                    <option value="paper">Paper Trading</option>
                                    <option value="live">Live Trading</option>
                                </select>
                            </div>
                            <div class="p-4 bg-gray-50 rounded-xl">
                                <h5 class="font-medium mb-3">üí∞ Max Per Trade</h5>
                                <input class="w-full px-3 py-2 border rounded-lg text-sm" id="ai-max-per-trade" onchange="updateAISetting('max_capital_per_trade', this.value)" placeholder="10000" type="number">
                            </div>
                            <div class="p-4 bg-gray-50 rounded-xl">
                                <h5 class="font-medium mb-3">üìà Risk Level</h5>
                                <select class="w-full px-3 py-2 border rounded-lg text-sm" id="ai-risk-level" onchange="updateAISetting('risk_level', this.value)">
                                    <option value="low">Low Risk</option>
                                    <option value="medium">Medium Risk</option>
                                    <option value="high">High Risk</option>
                                </select>
                            </div>
                        </div>

                        <!-- Enhanced Live AI Signals -->
                        <div class="mb-6">
                            <h4 class="font-medium mb-4 flex items-center">
                                üéØ Live AI Signals
                                <span class="ml-2 w-2 h-2 bg-green-500 rounded-full live-indicator"></span>
                                <span class="ml-2 text-xs bg-blue-100 px-2 py-1 rounded">Paper Trading Ready</span>
                            </h4>
                            <div class="space-y-3" id="ai-signals-container">
                                <div class="text-center text-gray-500 py-4">Start AI trading to see live signals...</div>
                            </div>
                        </div>

                        <!-- Recent AI Actions -->
                        <div>
                            <h4 class="font-medium mb-4 flex items-center">
                                üìã Recent AI Actions
                                <span class="ml-2 text-xs bg-purple-100 px-2 py-1 rounded">Live Updates</span>
                            </h4>
                            <div class="space-y-2 max-h-64 overflow-y-auto custom-scrollbar" id="ai-recent-actions">
                                <div class="text-center text-gray-500 py-4">No recent AI actions</div>
                            </div>
                        </div>
                    </div>

                    <!-- Executed Trades Section -->
                    <div class="bg-white rounded-2xl shadow-lg p-6 modern-card" id="trade-logs-section">
                        <h4 class="font-medium mb-4 flex items-center">
                            üìà Executed Trades
                            <span class="ml-2 text-xs bg-green-100 px-2 py-1 rounded">Real-time Updates</span>
                        </h4>
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse border border-gray-300">
                                <thead>
                                    <tr class="bg-gray-50">
                                        <th class="border border-gray-300 px-4 py-2 text-left">Symbol</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Qty</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Buy/Sell</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Entry Price</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Status</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">P&L</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Strategy</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Time</th>
                                    </tr>
                                </thead>
                                <tbody id="trade-logs-body">
                                    <tr>
                                        <td colspan="8" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                                            No trades executed yet. Start AI trading to see live trade data.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Other tabs remain the same as in original file... -->
                <!-- Broker Setup Tab -->
                <div class="tab-content space-y-6" id="tab-broker-setup">
                    <div class="bg-white rounded-2xl shadow-lg p-6 modern-card">
                        <div class="p-4 bg-blue-50 rounded-xl mb-6">
                            <h4 class="font-semibold text-blue-800 mb-2">üìù Paper Trading Active</h4>
                            <p class="text-sm text-blue-700">You're currently in paper trading mode with virtual money. This is perfect for testing strategies!</p>
                            <p class="text-xs text-blue-600 mt-2">üöÄ Start AI trading now without any broker setup required.</p>
                        </div>
                        
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold">üîó Broker Integration Setup</h3>
                            <div class="flex items-center space-x-3">
                                <div class="w-2 h-2 rounded-full bg-green-500" id="broker-connection-indicator"></div>
                                <span class="text-sm text-green-600" id="broker-connection-status">Paper Mode Active</span>
                            </div>
                        </div>

                        <!-- Add broker setup forms here if needed -->
                        <div class="text-center p-8 border-2 border-dashed border-gray-300 rounded-xl">
                            <div class="text-4xl mb-4">üè¶</div>
                            <h4 class="font-semibold mb-2">Ready to Connect Real Brokers?</h4>
                            <p class="text-sm text-gray-600 mb-4">Add your Zerodha or mStock credentials when you're ready for live trading.</p>
                            <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700" onclick="showNotification('info', 'üìã Broker setup will be available when switching to live mode')">
                                Setup Broker Integration
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Simplified other tabs for now... -->
                <div class="tab-content" id="tab-overview">
                    <div class="bg-white rounded-2xl shadow-lg p-6 modern-card">
                        <h3 class="text-lg font-semibold mb-4">üìä Market Overview</h3>
                        <div class="text-center py-8">
                            <p class="text-gray-600">Market data will be displayed here</p>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="tab-trading">
                    <div class="bg-white rounded-2xl shadow-lg p-6 modern-card">
                        <h3 class="text-lg font-semibold mb-4">‚ö° Manual Trading</h3>
                        <div class="text-center py-8">
                            <p class="text-gray-600">Manual trading interface will be here</p>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="tab-portfolio">
                    <div class="bg-white rounded-2xl shadow-lg p-6 modern-card">
                        <h3 class="text-lg font-semibold mb-4">üíº Portfolio & P&L</h3>
                        <div class="text-center py-8">
                            <p class="text-gray-600">Portfolio data will be displayed here</p>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="tab-reports">
                    <div class="bg-white rounded-2xl shadow-lg p-6 modern-card">
                        <h3 class="text-lg font-semibold mb-4">üìä Trade Reports</h3>
                        <div class="text-center py-8">
                            <p class="text-gray-600">Trade reports will be displayed here</p>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="tab-capital">
                    <div class="bg-white rounded-2xl shadow-lg p-6 modern-card">
                        <h3 class="text-lg font-semibold mb-4">üí∞ Capital Management</h3>
                        <div class="text-center py-8">
                            <p class="text-gray-600">Capital management settings will be here</p>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="tab-settings">
                    <div class="bg-white rounded-2xl shadow-lg p-6 modern-card">
                        <h3 class="text-lg font-semibold mb-4">‚öôÔ∏è AI Settings</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Trading Frequency (seconds)</label>
                                    <input class="w-full px-3 py-2 border rounded-lg" id="trading-frequency" placeholder="30" type="number" value="30">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Max Daily Trades</label>
                                    <input class="w-full px-3 py-2 border rounded-lg" id="max-daily-trades" placeholder="10" type="number" value="10">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Auto Stop Loss (%)</label>
                                    <input class="w-full px-3 py-2 border rounded-lg" id="auto-stop-loss" placeholder="5" step="0.1" type="number" value="5">
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Auto Take Profit (%)</label>
                                    <input class="w-full px-3 py-2 border rounded-lg" id="auto-take-profit" placeholder="10" step="0.1" type="number" value="10">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Allowed Symbols</label>
                                    <textarea class="w-full px-3 py-2 border rounded-lg h-20" id="allowed-symbols" placeholder="RELIANCE,TCS,HDFCBANK,INFY,ICICIBANK">RELIANCE,TCS,HDFCBANK,INFY,ICICIBANK</textarea>
                                </div>
                                <button class="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700" onclick="saveAISettings()">
                                    üíæ Save AI Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar - Watchlist & AI Status -->
            <aside class="sidebar space-y-6">
                <!-- Enhanced AI Trading Status -->
                <div class="bg-white rounded-2xl shadow-lg p-4 modern-card">
                    <h3 class="font-semibold mb-4 text-gray-900 flex items-center">
                        ü§ñ AI Status
                        <span class="ml-2 w-2 h-2 rounded-full status-inactive" id="ai-sidebar-indicator"></span>
                    </h3>
                    <div class="space-y-3 text-sm" id="ai-status-details-sidebar">
                        <div class="p-2 bg-green-50 rounded">
                            <div class="font-medium text-green-800">Status: Ready</div>
                            <div class="text-green-600">Paper trading ready!</div>
                        </div>
                    </div>
                    <div class="mt-3 text-xs">
                        <div class="flex justify-between">
                            <span>Next Analysis:</span>
                            <span id="next-analysis-time">--</span>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Live Updates -->
                <div class="bg-white rounded-2xl shadow-lg p-4 modern-card">
                    <h3 class="font-semibold mb-4 text-gray-900 flex items-center">
                        üì° Live Updates
                        <span class="ml-2 w-2 h-2 bg-green-500 rounded-full live-indicator"></span>
                    </h3>
                    <div class="space-y-3 text-xs" id="live-updates">
                        <div class="p-2 bg-green-50 rounded border-l-2 border-green-500">
                            <div class="font-medium text-green-800">System Online</div>
                            <div class="text-green-600">Paper trading ready!</div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Enhanced Notifications Panel -->
    <div class="fixed top-20 right-4 w-80 bg-white rounded-lg shadow-xl border z-50 max-h-96 overflow-y-auto hidden" id="notifications-panel">
        <div class="p-3 border-b">
            <h3 class="font-semibold">üîî Notifications</h3>
        </div>
        <div class="divide-y" id="notifications-container">
            <!-- Notifications will be populated here -->
        </div>
    </div>

    <script>
        // Enhanced Configuration with Paper Trading Priority
        const CONFIG = {
            AI_UPDATE_INTERVAL: 3000, // Faster updates for demo
            MARKET_UPDATE_INTERVAL: 30000,
            PORTFOLIO_UPDATE_INTERVAL: 15000,
            MAX_NOTIFICATIONS: 10,
            PAPER_TRADING_ENABLED: true // Always allow paper trading
        };

        // Global state management
        let appState = {
            currentAccountType: 'paper',
            isAITradingActive: false,
            activeBroker: null,
            brokerConnected: false, // Not required for paper trading
            paperTradingReady: true, // Always ready for paper trading
            lastTradeCount: 0,
            lastPositionCount: 0,
            marketDataInterval: null,
            aiStatusInterval: null,
            portfolioInterval: null,
            aiSimulationInterval: null,
            autoRefreshEnabled: true,
            notifications: [],
            tradingData: {
                positions: [],
                trades: [],
                aiSignals: [],
                aiActions: []
            }
        };

        // Simulated data for paper trading
        const simulatedData = {
            paperAccount: {
                balance: 1000000,
                invested: 0,
                pnl: 0,
                total_value: 1000000
            },
            aiSettings: {
                trading_mode: 'paper',
                max_capital_per_trade: 10000,
                risk_level: 'medium',
                trading_frequency: 30,
                max_daily_trades: 10,
                auto_stop_loss: 5.0,
                auto_take_profit: 10.0,
                allowed_symbols: ['RELIANCE', 'TCS', 'HDFCBANK', 'INFY', 'ICICIBANK']
            }
        };

        // Performance optimized DOM cache
        const domCache = {};

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            
            loadInitialData();
            loadPaperAccount();
            updateAIStatusUI(false);
            updateAIControlButtons();
            
            showNotification('success', 'üöÄ AI Trading Platform Ready! Paper trading enabled.');
            showNotification('info', 'üìù Click "Start AI Trading" to begin automated paper trading');
        });

        // Time management
        function updateTime() {
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = new Date().toLocaleTimeString();
            }
        }

        // Initialize application data
        function loadInitialData() {
            updateAccountTypeUI();
            loadTradeLogsTable();
            updatePositionsCount();
        }

        // Account Management
        function switchAccountType(type) {
            appState.currentAccountType = type;
            updateAccountTypeUI();
            
            if (type === 'paper') {
                loadPaperAccount();
                showNotification('info', 'üìù Switched to Paper Trading mode - Virtual money, real learning!');
            } else {
                showNotification('warning', 'üî¥ Live Trading requires broker setup');
            }
        }

        function updateAccountTypeUI() {
            const paperBtn = document.getElementById('paper-mode-btn');
            const liveBtn = document.getElementById('live-mode-btn');
            const accountBadge = document.getElementById('account-type-badge');
            const brokerStatusText = document.getElementById('broker-status-text');
            const apiStatus = document.getElementById('api-status');
            
            if (appState.currentAccountType === 'paper') {
                if (paperBtn) paperBtn.className = 'px-3 py-1 rounded-lg text-xs font-medium transition-all paper-badge text-white';
                if (liveBtn) liveBtn.className = 'px-3 py-1 rounded-lg text-xs font-medium transition-all bg-gray-200 text-gray-700 hover:bg-gray-300';
                if (accountBadge) {
                    accountBadge.textContent = 'Paper';
                    accountBadge.className = 'text-xs px-2 py-1 rounded-full bg-green-100 text-green-700';
                }
                if (brokerStatusText) brokerStatusText.textContent = 'Paper Mode';
                if (apiStatus) apiStatus.textContent = 'Paper Mode';
            } else {
                if (paperBtn) paperBtn.className = 'px-3 py-1 rounded-lg text-xs font-medium transition-all bg-gray-200 text-gray-700 hover:bg-gray-300';
                if (liveBtn) liveBtn.className = 'px-3 py-1 rounded-lg text-xs font-medium transition-all live-badge text-white';
                if (accountBadge) {
                    accountBadge.textContent = 'Live';
                    accountBadge.className = 'text-xs px-2 py-1 rounded-full bg-red-100 text-red-700';
                }
                if (brokerStatusText) brokerStatusText.textContent = 'Setup Required';
                if (apiStatus) apiStatus.textContent = 'Setup Required';
            }
        }

        function loadPaperAccount() {
            const account = simulatedData.paperAccount;
            updateElement('available-balance', `‚Çπ${account.balance.toLocaleString()}`);
            updateElement('invested-amount', `‚Çπ${account.invested.toLocaleString()}`);
            updateElement('total-pnl', `‚Çπ${account.pnl.toLocaleString()}`);
            updateElement('total-value', `‚Çπ${account.total_value.toLocaleString()}`);
            updateElement('daily-pnl', `‚Çπ${account.pnl.toLocaleString()}`);
        }

        // Enhanced AI Trading Management Functions
        function handleStartAI() {
            // For paper trading, no broker connection required
            if (appState.currentAccountType === 'live' && !appState.brokerConnected) {
                showNotification('error', '‚ùå Please connect a broker for live trading');
                switchTab('broker-setup');
                return;
            }
            
            if (appState.isAITradingActive) {
                showNotification('warning', '‚ö†Ô∏è AI Trading is already active');
                return;
            }
            
            startAITrading();
        }

        function handleStopAI() {
            if (!appState.isAITradingActive) {
                showNotification('warning', '‚ö†Ô∏è AI Trading is already inactive');
                return;
            }
            
            stopAITrading();
        }

        function startAITrading() {
            appState.isAITradingActive = true;
            updateAIStatusUI(true);
            updateAIControlButtons();
            
            if (appState.currentAccountType === 'paper') {
                showNotification('success', 'ü§ñ AI Paper Trading started! Virtual trades incoming...');
            } else {
                showNotification('success', 'ü§ñ AI Live Trading started!');
            }
            
            // Start AI simulation immediately
            startAISimulation();
        }

        function stopAITrading() {
            appState.isAITradingActive = false;
            updateAIStatusUI(false);
            updateAIControlButtons();
            showNotification('warning', 'üõë AI Trading stopped');
            
            // Stop AI simulation
            stopAISimulation();
        }

        function toggleAITrading() {
            if (appState.isAITradingActive) {
                handleStopAI();
            } else {
                handleStartAI();
            }
        }

        function updateAIControlButtons() {
            const startBtn = document.getElementById('start-ai-btn');
            const stopBtn = document.getElementById('stop-ai-btn');
            
            // For paper trading, always allow starting
            const canStart = appState.currentAccountType === 'paper' || appState.brokerConnected;
            
            if (appState.isAITradingActive) {
                // AI is active - enable stop, disable start
                if (startBtn) {
                    startBtn.disabled = true;
                    startBtn.className = 'w-full px-3 py-2 rounded-lg text-sm font-medium transition-all bg-gray-400 text-white cursor-not-allowed';
                }
                if (stopBtn) {
                    stopBtn.disabled = false;
                    stopBtn.className = 'w-full px-3 py-2 rounded-lg text-sm font-medium transition-all bg-red-600 text-white hover:bg-red-700';
                }
            } else {
                // AI is inactive - enable start if conditions met, disable stop
                if (startBtn) {
                    startBtn.disabled = !canStart;
                    startBtn.className = canStart 
                        ? 'w-full px-3 py-2 rounded-lg text-sm font-medium transition-all ai-gradient text-white hover:ai-glow'
                        : 'w-full px-3 py-2 rounded-lg text-sm font-medium transition-all bg-gray-400 text-white cursor-not-allowed';
                }
                if (stopBtn) {
                    stopBtn.disabled = true;
                    stopBtn.className = 'w-full px-3 py-2 rounded-lg text-sm font-medium transition-all bg-gray-400 text-white cursor-not-allowed';
                }
            }
        }

        function updateAIStatusUI(isActive) {
            appState.isAITradingActive = isActive;
            
            const elements = {
                statusText: document.getElementById('ai-status-text'),
                statusDot: document.getElementById('ai-status-dot'),
                controlIndicator: document.getElementById('ai-control-indicator'),
                controlStatus: document.getElementById('ai-control-status'),
                dashboardIndicator: document.getElementById('ai-dashboard-indicator'),
                bannerIndicator: document.getElementById('ai-banner-indicator'),
                bannerTitle: document.getElementById('ai-banner-title'),
                bannerDesc: document.getElementById('ai-banner-desc'),
                toggleBtn: document.getElementById('ai-toggle-btn'),
                statusDetails: document.getElementById('ai-status-details'),
                sidebarIndicator: document.getElementById('ai-sidebar-indicator')
            };
            
            if (isActive) {
                // Update all status indicators for active state
                if (elements.statusText) elements.statusText.textContent = 'AI Active';
                if (elements.controlStatus) elements.controlStatus.textContent = 'Active';
                if (elements.statusDot) elements.statusDot.className = 'w-3 h-3 rounded-full status-active ai-pulse';
                if (elements.controlIndicator) elements.controlIndicator.className = 'w-2 h-2 rounded-full status-active live-indicator';
                if (elements.dashboardIndicator) elements.dashboardIndicator.className = 'w-3 h-3 rounded-full status-active live-indicator';
                if (elements.bannerIndicator) elements.bannerIndicator.className = 'w-4 h-4 rounded-full status-active live-indicator';
                if (elements.sidebarIndicator) elements.sidebarIndicator.className = 'w-2 h-2 rounded-full status-active live-indicator';
                
                if (elements.bannerTitle) elements.bannerTitle.textContent = 'ü§ñ AI Trading Active';
                if (elements.bannerDesc) {
                    elements.bannerDesc.textContent = appState.currentAccountType === 'paper' 
                        ? 'Automated paper trading in progress with virtual money'
                        : 'Automated live trading in progress with real money';
                }
                if (elements.toggleBtn) elements.toggleBtn.textContent = 'Stop AI';
                
                if (elements.statusDetails) {
                    elements.statusDetails.textContent = appState.currentAccountType === 'paper'
                        ? 'AI actively analyzing markets with paper trading'
                        : 'AI actively analyzing markets and executing live trades';
                }
                
                // Update banner background
                const banner = document.getElementById('ai-status-banner');
                if (banner) banner.className = 'p-4 rounded-xl mb-6 ai-gradient text-white';
                
                // Update sidebar status
                const sidebarStatus = document.getElementById('ai-status-details-sidebar');
                if (sidebarStatus) {
                    sidebarStatus.innerHTML = `
                        <div class="p-2 bg-green-50 rounded">
                            <div class="font-medium text-green-800">Status: Active</div>
                            <div class="text-green-600">${appState.currentAccountType === 'paper' ? 'Paper trading' : 'Live trading'}</div>
                        </div>
                    `;
                }
                
            } else {
                // Update all status indicators for inactive state
                if (elements.statusText) elements.statusText.textContent = 'AI Inactive';
                if (elements.controlStatus) elements.controlStatus.textContent = 'Inactive';
                if (elements.statusDot) elements.statusDot.className = 'w-3 h-3 rounded-full status-inactive';
                if (elements.controlIndicator) elements.controlIndicator.className = 'w-2 h-2 rounded-full status-inactive';
                if (elements.dashboardIndicator) elements.dashboardIndicator.className = 'w-3 h-3 rounded-full status-inactive';
                if (elements.bannerIndicator) elements.bannerIndicator.className = 'w-4 h-4 rounded-full status-inactive';
                if (elements.sidebarIndicator) elements.sidebarIndicator.className = 'w-2 h-2 rounded-full status-inactive';
                
                if (elements.bannerTitle) elements.bannerTitle.textContent = 'ü§ñ AI Trading Ready';
                if (elements.bannerDesc) {
                    elements.bannerDesc.textContent = appState.currentAccountType === 'paper'
                        ? 'Paper trading is ready! Click Start to begin automated trading with virtual money.'
                        : 'Connect broker and configure settings to start live trading';
                }
                if (elements.toggleBtn) elements.toggleBtn.textContent = 'Start AI';
                
                if (elements.statusDetails) {
                    elements.statusDetails.textContent = appState.currentAccountType === 'paper'
                        ? 'Ready for paper trading! Click Start to begin.'
                        : 'Connect broker to enable AI trading';
                }
                
                // Update banner background
                const banner = document.getElementById('ai-status-banner');
                if (banner) banner.className = 'p-4 rounded-xl mb-6 bg-gray-100 text-gray-800';
                
                // Update sidebar status
                const sidebarStatus = document.getElementById('ai-status-details-sidebar');
                if (sidebarStatus) {
                    sidebarStatus.innerHTML = `
                        <div class="p-2 bg-green-50 rounded">
                            <div class="font-medium text-green-800">Status: Ready</div>
                            <div class="text-green-600">${appState.currentAccountType === 'paper' ? 'Paper trading ready!' : 'Setup required'}</div>
                        </div>
                    `;
                }
            }
            
            // Update trades counter
            updateElement('ai-trades-counter', `${appState.tradingData.trades.filter(t => t.strategy === 'AI_AUTO').length} trades`);
        }

        // AI Simulation Functions
        function startAISimulation() {
            if (appState.aiSimulationInterval) clearInterval(appState.aiSimulationInterval);
            
            // Generate first signal immediately
            setTimeout(() => {
                if (appState.isAITradingActive) {
                    generateAISignal();
                    updateAIMetrics();
                }
            }, 1000);
            
            appState.aiSimulationInterval = setInterval(() => {
                if (appState.isAITradingActive) {
                    generateAISignal();
                    updateAIMetrics();
                    
                    // Occasionally execute a trade (higher chance for demo)
                    if (Math.random() < 0.4) {
                        executeAITrade();
                    }
                }
            }, CONFIG.AI_UPDATE_INTERVAL);
            
            showNotification('info', 'üéØ AI analysis started - generating signals...');
        }

        function stopAISimulation() {
            if (appState.aiSimulationInterval) {
                clearInterval(appState.aiSimulationInterval);
                appState.aiSimulationInterval = null;
            }
        }

        function generateAISignal() {
            const symbols = simulatedData.aiSettings.allowed_symbols;
            const symbol = symbols[Math.floor(Math.random() * symbols.length)];
            const signals = ['BUY', 'SELL', 'HOLD'];
            const signal = signals[Math.floor(Math.random() * signals.length)];
            const confidence = Math.floor(Math.random() * 40) + 60; // 60-100%
            const price = Math.floor(Math.random() * 1000) + 1000;
            
            const reasons = [
                'Technical breakout detected',
                'Volume surge identified',
                'Support level confirmed',
                'Momentum indicator positive',
                'Moving average crossover',
                'RSI oversold condition',
                'Bollinger band squeeze',
                'MACD bullish divergence'
            ];
            
            const aiSignal = {
                symbol,
                signal,
                confidence,
                current_price: price,
                reasons: [reasons[Math.floor(Math.random() * reasons.length)]]
            };
            
            appState.tradingData.aiSignals.unshift(aiSignal);
            if (appState.tradingData.aiSignals.length > 8) {
                appState.tradingData.aiSignals.pop();
            }
            
            updateAISignalsDisplay();
        }

        function updateAISignalsDisplay() {
            const container = document.getElementById('ai-signals-container');
            if (!container || appState.tradingData.aiSignals.length === 0) {
                if (container) {
                    container.innerHTML = '<div class="text-center text-gray-500 py-4">Generating AI signals...</div>';
                }
                return;
            }
            
            const signalsHtml = appState.tradingData.aiSignals.map(signal => {
                const signalClass = signal.signal === 'BUY' ? 'signal-buy' : signal.signal === 'SELL' ? 'signal-sell' : 'signal-hold';
                const signalIcon = signal.signal === 'BUY' ? 'üìà' : signal.signal === 'SELL' ? 'üìâ' : '‚è∏Ô∏è';
                const confidenceColor = signal.confidence > 80 ? 'text-green-600' : signal.confidence > 60 ? 'text-blue-600' : 'text-orange-600';
                
                return `
                    <div class="p-3 rounded-lg ${signalClass} hover-scale">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="font-medium">${signalIcon} ${signal.symbol} - ${signal.signal}</div>
                                <div class="text-sm opacity-80">Price: ‚Çπ${signal.current_price} | Confidence: <span class="${confidenceColor}">${signal.confidence}%</span></div>
                                <div class="text-xs opacity-70">${signal.reasons.join(', ')}</div>
                            </div>
                            <div class="text-2xl opacity-50">${signal.confidence > 80 ? 'üî•' : signal.confidence > 60 ? '‚≠ê' : 'üí°'}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = signalsHtml;
        }

        function executeAITrade() {
            const symbols = simulatedData.aiSettings.allowed_symbols;
            const symbol = symbols[Math.floor(Math.random() * symbols.length)];
            const sides = ['BUY', 'SELL'];
            const side = sides[Math.floor(Math.random() * sides.length)];
            const quantity = Math.floor(Math.random() * 10) + 1;
            const price = Math.floor(Math.random() * 1000) + 1000;
            
            const trade = {
                id: Date.now(),
                symbol,
                side,
                quantity,
                price,
                value: quantity * price,
                strategy: 'AI_AUTO',
                account_type: appState.currentAccountType,
                timestamp: new Date().toISOString(),
                status: 'EXECUTED',
                pnl: (Math.random() - 0.3) * 500 // Slightly positive bias for demo
            };
            
            appState.tradingData.trades.unshift(trade);
            
            // Add to AI actions
            const action = {
                action: 'TRADE_EXECUTED',
                symbol,
                signal_type: side,
                quantity,
                status: 'SUCCESS',
                reason: `AI signal triggered automatic ${appState.currentAccountType} trade`,
                timestamp: new Date().toISOString()
            };
            
            appState.tradingData.aiActions.unshift(action);
            if (appState.tradingData.aiActions.length > 15) {
                appState.tradingData.aiActions.pop();
            }
            
            // Update account balance for paper trading
            if (appState.currentAccountType === 'paper') {
                if (side === 'BUY') {
                    simulatedData.paperAccount.balance -= trade.value;
                    simulatedData.paperAccount.invested += trade.value;
                } else {
                    simulatedData.paperAccount.balance += trade.value;
                    simulatedData.paperAccount.invested = Math.max(0, simulatedData.paperAccount.invested - trade.value);
                }
                simulatedData.paperAccount.pnl += trade.pnl;
                simulatedData.paperAccount.total_value = simulatedData.paperAccount.balance + simulatedData.paperAccount.invested + simulatedData.paperAccount.pnl;
                
                loadPaperAccount();
            }
            
            updateTradeLogsTable();
            updateAIActionsDisplay();
            updatePositionsCount();
            
            const tradeType = appState.currentAccountType === 'paper' ? 'Paper' : 'Live';
            showNotification('success', `ü§ñ AI ${tradeType}: ${side} ${quantity} ${symbol} at ‚Çπ${price}`);
        }

        function updateAIActionsDisplay() {
            const container = document.getElementById('ai-recent-actions');
            if (!container || appState.tradingData.aiActions.length === 0) {
                if (container) {
                    container.innerHTML = '<div class="text-center text-gray-500 py-4">No AI actions yet</div>';
                }
                return;
            }
            
            const actionsHtml = appState.tradingData.aiActions.slice(0, 10).map(action => {
                const statusIcon = action.status === 'SUCCESS' ? '‚úÖ' : '‚ùå';
                const actionIcon = action.action === 'TRADE_EXECUTED' ? 'üí±' : 'üìä';
                const cardClass = action.status === 'SUCCESS' ? 'bg-green-50 border-l-2 border-green-500' : 'bg-red-50 border-l-2 border-red-500';
                
                return `
                    <div class="p-2 rounded ${cardClass} text-xs">
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="font-medium">${statusIcon} ${actionIcon} ${action.symbol || 'System'}</span>
                                <span class="text-gray-600">${action.signal_type || action.action}</span>
                                ${action.quantity ? `<span class="text-gray-500">Qty: ${action.quantity}</span>` : ''}
                            </div>
                            <div class="text-gray-500">${new Date(action.timestamp).toLocaleTimeString()}</div>
                        </div>
                        ${action.reason ? `<div class="text-gray-600 mt-1">${action.reason}</div>` : ''}
                    </div>
                `;
            }).join('');
            
            container.innerHTML = actionsHtml;
            
            // Update last action display
            if (appState.tradingData.aiActions.length > 0) {
                const lastAction = appState.tradingData.aiActions[0];
                updateElement('ai-last-action', `Last: ${lastAction.action} at ${new Date(lastAction.timestamp).toLocaleTimeString()}`);
            }
        }

        function updateAIMetrics() {
            const aiTrades = appState.tradingData.trades.filter(t => t.strategy === 'AI_AUTO');
            const todayTrades = aiTrades.filter(t => {
                const today = new Date().toDateString();
                return new Date(t.timestamp).toDateString() === today;
            });
            
            const totalProfit = aiTrades.reduce((sum, trade) => sum + (trade.pnl || 0), 0);
            const winningTrades = aiTrades.filter(t => (t.pnl || 0) > 0).length;
            const winRate = aiTrades.length > 0 ? (winningTrades / aiTrades.length * 100) : 0;
            const avgReturn = aiTrades.length > 0 ? (totalProfit / aiTrades.length / 10000 * 100) : 0;
            
            updateElement('ai-profit-total', `‚Çπ${totalProfit.toLocaleString()}`);
            updateElement('ai-trades-today', todayTrades.length);
            updateElement('ai-win-rate', `${winRate.toFixed(1)}%`);
            updateElement('ai-avg-return', `${avgReturn.toFixed(2)}%`);
            updateElement('ai-trades-count', aiTrades.length);
            updateElement('ai-success-rate', `Success Rate: ${winRate.toFixed(1)}%`);
        }

        // Trade Logs and Reports
        function loadTradeLogsTable() {
            const tbody = document.getElementById('trade-logs-body');
            if (!tbody) return;
            
            if (appState.tradingData.trades.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                            No trades executed yet. Start AI trading to see live trade data.
                        </td>
                    </tr>
                `;
                return;
            }
            
            const tradesHtml = appState.tradingData.trades.slice(0, 20).map(trade => `
                <tr class="hover:bg-gray-50">
                    <td class="border border-gray-300 px-4 py-2">${trade.symbol}</td>
                    <td class="border border-gray-300 px-4 py-2">${trade.quantity}</td>
                    <td class="border border-gray-300 px-4 py-2">
                        <span class="px-2 py-1 rounded text-xs ${trade.side === 'BUY' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${trade.side}
                        </span>
                    </td>
                    <td class="border border-gray-300 px-4 py-2">‚Çπ${trade.price.toFixed(2)}</td>
                    <td class="border border-gray-300 px-4 py-2">
                        <span class="px-2 py-1 rounded text-xs bg-green-100 text-green-800">${trade.status}</span>
                    </td>
                    <td class="border border-gray-300 px-4 py-2 ${trade.pnl >= 0 ? 'text-green-600' : 'text-red-600'}">
                        ${trade.pnl >= 0 ? '+' : ''}‚Çπ${trade.pnl.toFixed(2)}
                    </td>
                    <td class="border border-gray-300 px-4 py-2">
                        <span class="px-2 py-1 rounded text-xs ${trade.strategy === 'AI_AUTO' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'}">
                            ${trade.strategy === 'AI_AUTO' ? 'ü§ñ AI' : 'üë§ Manual'}
                        </span>
                    </td>
                    <td class="border border-gray-300 px-4 py-2 text-xs text-gray-600">
                        ${new Date(trade.timestamp).toLocaleString()}
                    </td>
                </tr>
            `).join('');
            
            tbody.innerHTML = tradesHtml;
        }

        function updateTradeLogsTable() {
            loadTradeLogsTable();
        }

        function updatePositionsCount() {
            const positions = appState.tradingData.trades.filter(t => t.account_type === appState.currentAccountType);
            updateElement('positions-count', positions.length);
            updateElement('trades-count', appState.tradingData.trades.length);
        }

        // Tab system
        function switchTab(tabName) {
            const tabContents = document.querySelectorAll('.tab-content');
            const tabButtons = document.querySelectorAll('.tab-button');
            
            tabContents.forEach(tab => tab.classList.remove('active'));
            tabButtons.forEach(btn => btn.classList.remove('active'));
            
            const selectedTab = document.getElementById(`tab-${tabName}`);
            if (selectedTab) {
                selectedTab.classList.add('active');
                event.target.classList.add('active');
            }
        }

        // Settings functions
        function updateAISetting(key, value) {
            simulatedData.aiSettings[key] = value;
            showNotification('info', `‚úÖ ${key.replace('_', ' ')} updated to ${value}`);
        }

        function saveAISettings() {
            showNotification('success', 'üíæ AI settings saved successfully');
        }

        function refreshAIData() {
            updateAISignalsDisplay();
            updateAIActionsDisplay();
            updateAIMetrics();
            showNotification('success', 'üîÑ AI data refreshed');
        }

        // Utility Functions
        function updateElement(id, content) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = content;
            }
        }

        // Notification system
        function toggleNotifications() {
            const panel = document.getElementById('notifications-panel');
            if (panel) {
                panel.classList.toggle('hidden');
            }
        }

        function showNotification(type, message) {
            const colors = {
                'success': 'bg-green-100 text-green-800 border-green-200',
                'error': 'bg-red-100 text-red-800 border-red-200',
                'warning': 'bg-yellow-100 text-yellow-800 border-yellow-200',
                'info': 'bg-blue-100 text-blue-800 border-blue-200'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg border z-50 ${colors[type]} notification-enter max-w-sm shadow-lg`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span class="text-sm font-medium">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-gray-500 hover:text-gray-700 font-bold">√ó</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Update notification count
            const count = document.getElementById('notification-count');
            if (count) {
                count.textContent = parseInt(count.textContent) + 1;
            }
            
            // Add to live updates
            const liveUpdates = document.getElementById('live-updates');
            if (liveUpdates) {
                const updateDiv = document.createElement('div');
                updateDiv.className = `p-2 rounded border-l-2 text-xs ${type === 'success' ? 'bg-green-50 border-green-500' : 
                                                                        type === 'error' ? 'bg-red-50 border-red-500' :
                                                                        type === 'warning' ? 'bg-yellow-50 border-yellow-500' : 'bg-blue-50 border-blue-500'}`;
                updateDiv.innerHTML = `
                    <div class="font-medium">${message}</div>
                    <div class="text-gray-500">${new Date().toLocaleTimeString()}</div>
                `;
                liveUpdates.insertBefore(updateDiv, liveUpdates.firstChild);
                
                // Keep only last 5 updates
                while (liveUpdates.children.length > 5) {
                    liveUpdates.removeChild(liveUpdates.lastChild);
                }
            }
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.parentElement.removeChild(notification);
                }
            }, 5000);
        }
    </script>
</body>
</html>
