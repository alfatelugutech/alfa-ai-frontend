<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Trading Platform Pro v2.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <style>
        @import url('https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css');
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .animate-bounce { animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8,0,1,1); } 50% { transform: none; animation-timing-function: cubic-bezier(0,0,0.2,1); } }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .hover-scale:hover { transform: scale(1.05); }
        .notification-enter { animation: slideInRight 0.3s ease-out; }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app">
        <!-- Header -->
        <header class="bg-white shadow-lg border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <div class="h-8 w-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold mr-3">🧠</div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900 flex items-center">
                                🚀 AI Trading Platform Pro
                                <span class="ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs">Professional v2.0</span>
                            </h1>
                            <p class="text-xs text-gray-500">Zerodha API • Capital Management • Auto-Save • Stock Search • Market Scanner • PDF Reports</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                            <span class="text-sm text-gray-600">Market Open</span>
                            <span class="text-xs text-gray-500" id="current-time"></span>
                        </div>
                        
                        <div class="flex items-center space-x-1">
                            <div class="h-4 w-4 text-green-600">📶</div>
                            <span class="text-xs text-gray-600" id="connection-status">Zerodha Connected</span>
                        </div>
                        
                        <span class="px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800" id="trading-mode">
                            📄 Paper Mode
                        </span>
                        
                        <button class="relative p-2 text-gray-600 hover:text-gray-900 transition-all" onclick="toggleNotifications()">
                            🔔
                            <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-bounce" id="notification-count">3</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white border-b shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8 overflow-x-auto">
                    <button onclick="setActiveTab('dashboard')" class="tab-button flex items-center px-3 py-4 text-sm font-medium border-b-2 transition-all whitespace-nowrap text-blue-600 border-blue-600 bg-blue-50" data-tab="dashboard">
                        📊 Dashboard
                    </button>
                    <button onclick="setActiveTab('strategies')" class="tab-button flex items-center px-3 py-4 text-sm font-medium border-b-2 transition-all whitespace-nowrap text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" data-tab="strategies">
                        🧠 AI Strategies
                    </button>
                    <button onclick="setActiveTab('positions')" class="tab-button flex items-center px-3 py-4 text-sm font-medium border-b-2 transition-all whitespace-nowrap text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" data-tab="positions">
                        🎯 Live Positions
                    </button>
                    <button onclick="setActiveTab('trades')" class="tab-button flex items-center px-3 py-4 text-sm font-medium border-b-2 transition-all whitespace-nowrap text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" data-tab="trades">
                        📋 Trade Reports
                    </button>
                    <button onclick="setActiveTab('stocksearch')" class="tab-button flex items-center px-3 py-4 text-sm font-medium border-b-2 transition-all whitespace-nowrap text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" data-tab="stocksearch">
                        🔍 Stock Search
                    </button>
                    <button onclick="setActiveTab('scanner')" class="tab-button flex items-center px-3 py-4 text-sm font-medium border-b-2 transition-all whitespace-nowrap text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" data-tab="scanner">
                        📡 Market Scanner
                        <span class="ml-2 w-2 h-2 bg-green-500 rounded-full animate-pulse" id="scanner-indicator" style="display: none;"></span>
                    </button>
                    <button onclick="setActiveTab('brokers')" class="tab-button flex items-center px-3 py-4 text-sm font-medium border-b-2 transition-all whitespace-nowrap text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" data-tab="brokers">
                        ⚙️ Broker Setup
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Enhanced Disclaimer -->
            <div class="bg-gradient-to-r from-blue-50 via-purple-50 to-pink-50 border border-blue-200 rounded-2xl p-4 mb-6 shadow-lg">
                <div class="flex items-center">
                    <div class="h-6 w-6 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold mr-3">🧠</div>
                    <div>
                        <p class="text-blue-800 text-sm font-medium">
                            <strong>🚀 Professional AI Trading Platform v2.0:</strong> Complete Zerodha API integration with auto-save • Stock search with 15+ stocks • Auto-refreshing market scanner (1min) • 15+ live positions tracking • PDF/Excel/JPEG report generation • Paper trading with reset options • Real-time notifications.
                            <span id="trading-mode-text">Currently in Paper Trading mode - ₹10,00,000 virtual capital.</span>
                        </p>
                        <p class="text-blue-700 text-xs mt-1 flex items-center space-x-4">
                            <span>✅ Complete Zerodha Setup</span>
                            <span>✅ Auto-Save Settings</span>
                            <span>✅ Stock Search & Scanner</span>
                            <span>✅ 15+ Live Positions</span>
                            <span>✅ PDF/Excel Reports</span>
                            <span>✅ Real-time Updates</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Tab Content Container -->
            <div id="tab-content">
                <!-- Dashboard Tab -->
                <div id="dashboard-tab" class="tab-content">
                    <!-- AI Command Center -->
                    <div class="gradient-bg p-6 rounded-2xl shadow-2xl text-white mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-2xl font-bold mb-2 flex items-center">
                                    🤖 AI Trading Command Center
                                    <span class="ml-2 px-2 py-1 bg-white bg-opacity-20 rounded-lg text-sm">Professional v2.0</span>
                                </h3>
                                <div class="flex items-center space-x-6 text-sm">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 rounded-full mr-2 bg-green-400 animate-pulse"></div>
                                        <span>Market Open</span>
                                    </div>
                                    <div>🎯 Strategies: 6/7</div>
                                    <div>📊 Positions: 15</div>
                                    <div>💰 Total Capital: ₹30,50,000</div>
                                </div>
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="toggleTradingMode()" class="px-4 py-2 rounded-xl font-medium transition-all bg-yellow-500 hover:bg-yellow-600" id="trading-mode-btn">
                                    📄 Paper Mode
                                </button>
                                <button onclick="toggleAutoTrading()" class="px-6 py-2 rounded-xl font-medium transition-all transform hover:scale-105 bg-green-500 hover:bg-green-600 shadow-lg" id="auto-trading-btn">
                                    ▶️ Start AI
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Portfolio Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-700 p-4 rounded-2xl shadow-lg text-white transform hover-scale transition-all cursor-pointer">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">Portfolio Value</p>
                                    <p class="text-xl font-bold">₹18,47,500</p>
                                </div>
                                <div class="text-blue-200 text-2xl">₹</div>
                            </div>
                            <span class="text-blue-100 text-xs">+₹67,820 (3.81%)</span>
                        </div>

                        <div class="bg-gradient-to-br from-green-500 to-green-700 p-4 rounded-2xl shadow-lg text-white transform hover-scale transition-all cursor-pointer">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">Capital Allocated</p>
                                    <p class="text-xl font-bold">₹30,50,000</p>
                                </div>
                                <div class="text-green-200 text-2xl">💰</div>
                            </div>
                            <span class="text-green-100 text-xs">Used: ₹4,76,000</span>
                        </div>

                        <div class="bg-gradient-to-br from-purple-500 to-purple-700 p-4 rounded-2xl shadow-lg text-white transform hover-scale transition-all cursor-pointer">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-sm">Paper Capital</p>
                                    <p class="text-xl font-bold">₹10,00,000</p>
                                </div>
                                <div class="text-purple-200 text-2xl">📄</div>
                            </div>
                            <span class="text-purple-100 text-xs">P&L: +₹12,500</span>
                        </div>

                        <div class="bg-gradient-to-br from-orange-500 to-orange-700 p-4 rounded-2xl shadow-lg text-white transform hover-scale transition-all cursor-pointer">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-orange-100 text-sm">Active Positions</p>
                                    <p class="text-xl font-bold">15</p>
                                </div>
                                <div class="text-orange-200 text-2xl">🎯</div>
                            </div>
                            <span class="text-orange-100 text-xs">Trailing SL: 12</span>
                        </div>

                        <div class="bg-gradient-to-br from-teal-500 to-teal-700 p-4 rounded-2xl shadow-lg text-white transform hover-scale transition-all cursor-pointer">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-teal-100 text-sm">Zerodha API</p>
                                    <p class="text-xl font-bold">Connected</p>
                                </div>
                                <div class="text-teal-200 text-2xl">📶</div>
                            </div>
                            <span class="text-teal-100 text-xs">Trading Enabled</span>
                        </div>

                        <div class="bg-gradient-to-br from-pink-500 to-pink-700 p-4 rounded-2xl shadow-lg text-white transform hover-scale transition-all cursor-pointer">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-pink-100 text-sm">Today's Trades</p>
                                    <p class="text-xl font-bold">5</p>
                                </div>
                                <div class="text-pink-200 text-2xl">📊</div>
                            </div>
                            <span class="text-pink-100 text-xs">Win Rate: 80%</span>
                        </div>
                    </div>

                    <!-- Quick Actions Panel -->
                    <div class="bg-white p-6 rounded-2xl shadow-lg border">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            ⚡ Quick Actions & Platform Status
                            <span class="ml-2 px-2 py-1 bg-green-100 text-green-700 rounded-lg text-xs animate-pulse">Live System</span>
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <!-- Emergency Controls -->
                            <div class="p-4 bg-red-50 rounded-lg border-2 border-red-200">
                                <h4 class="font-medium text-red-800 mb-3 flex items-center">🚨 Emergency Controls</h4>
                                <div class="space-y-2">
                                    <button onclick="emergencyStop()" class="w-full px-3 py-2 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700 transition-all font-medium">
                                        🛑 Emergency Stop All
                                    </button>
                                    <button onclick="closeLivePositions()" class="w-full px-3 py-2 bg-orange-600 text-white rounded-lg text-sm hover:bg-orange-700 transition-all">
                                        ⏹️ Close Live Positions
                                    </button>
                                </div>
                            </div>

                            <!-- System Status -->
                            <div class="p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
                                <h4 class="font-medium text-blue-800 mb-3">📊 System Status</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span>Platform Status:</span>
                                        <span class="font-medium text-green-600 flex items-center">
                                            Online <div class="w-2 h-2 bg-green-500 rounded-full ml-1 animate-pulse"></div>
                                        </span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Auto-Save:</span>
                                        <span class="font-medium text-green-600">Active</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Uptime:</span>
                                        <span class="font-medium text-green-600">Running</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Trading -->
                            <div class="p-4 bg-green-50 rounded-lg border-2 border-green-200">
                                <h4 class="font-medium text-green-800 mb-3">⚡ Quick Trading</h4>
                                <div class="space-y-2">
                                    <button onclick="setActiveTab('stocksearch')" class="w-full px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition-all">
                                        🔍 Search Stocks
                                    </button>
                                    <button onclick="setActiveTab('scanner')" class="w-full px-3 py-2 bg-purple-600 text-white rounded-lg text-sm hover:bg-purple-700 transition-all">
                                        📡 Market Scanner
                                    </button>
                                    <button onclick="generateReport('excel')" class="w-full px-3 py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700 transition-all">
                                        📊 Generate Report
                                    </button>
                                </div>
                            </div>

                            <!-- Settings & Backup -->
                            <div class="p-4 bg-purple-50 rounded-lg border-2 border-purple-200">
                                <h4 class="font-medium text-purple-800 mb-3">⚙️ Settings & Backup</h4>
                                <div class="space-y-2">
                                    <button onclick="saveAllSettings()" class="w-full px-3 py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700 transition-all">
                                        💾 Save All Settings
                                    </button>
                                    <button onclick="setActiveTab('brokers')" class="w-full px-3 py-2 bg-orange-600 text-white rounded-lg text-sm hover:bg-orange-700 transition-all">
                                        🔧 Setup Zerodha
                                    </button>
                                    <button onclick="createBackup()" class="w-full px-3 py-2 bg-gray-600 text-white rounded-lg text-sm hover:bg-gray-700 transition-all">
                                        🆘 Emergency Backup
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stock Search Tab -->
                <div id="stocksearch-tab" class="tab-content hidden">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold flex items-center">
                                🔍 Advanced Stock Search
                                <span class="ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs">Real-time Data</span>
                            </h3>
                            <button onclick="clearStockSearch()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all">
                                🔄 Clear Search
                            </button>
                        </div>

                        <div class="relative mb-6">
                            <div class="absolute left-3 top-3 text-gray-400">🔍</div>
                            <input
                                type="text"
                                id="stock-search-input"
                                onkeyup="searchStocks()"
                                placeholder="Search stocks by symbol or company name (e.g., RELIANCE, TCS, HDFC)"
                                class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            />
                        </div>

                        <div id="stock-search-results" class="space-y-3 hidden">
                            <h4 class="font-medium text-gray-900">Search Results</h4>
                            <div id="search-results-container"></div>
                        </div>

                        <div class="mt-8">
                            <h4 class="font-medium text-gray-900 mb-4">📊 Popular Stocks</h4>
                            <div class="grid grid-cols-2 md:grid-cols-6 gap-3" id="popular-stocks">
                                <!-- Popular stocks will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Market Scanner Tab -->
                <div id="scanner-tab" class="tab-content hidden">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold flex items-center">
                                📡 AI Market Scanner
                                <span class="ml-2 w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                <span class="ml-1 px-2 py-1 bg-green-100 text-green-700 rounded-lg text-xs">Auto-Refresh 1min</span>
                            </h3>
                            <div class="flex space-x-2">
                                <button onclick="refreshScanner()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all">
                                    🔄 Refresh Now
                                </button>
                                <button onclick="generateReport('excel')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all">
                                    📊 Export Excel
                                </button>
                            </div>
                        </div>

                        <div class="mb-4 text-sm text-gray-600">
                            Last scan: <span id="last-scan-time">Never</span> | Next scan in: <span class="font-medium text-blue-600">Auto 1min</span>
                        </div>

                        <div id="scanner-results" class="overflow-x-auto">
                            <!-- Scanner results will be populated by JavaScript -->
                        </div>

                        <!-- Scanner Statistics -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6">
                            <div class="bg-gradient-to-r from-green-500 to-green-600 p-4 rounded-2xl text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-green-100 text-sm">BUY Signals</p>
                                        <p class="text-2xl font-bold" id="buy-signals">0</p>
                                    </div>
                                    <div class="text-green-200 text-2xl">📈</div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-red-500 to-red-600 p-4 rounded-2xl text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-red-100 text-sm">SELL Signals</p>
                                        <p class="text-2xl font-bold" id="sell-signals">0</p>
                                    </div>
                                    <div class="text-red-200 text-2xl">📉</div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 p-4 rounded-2xl text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-yellow-100 text-sm">HOLD Signals</p>
                                        <p class="text-2xl font-bold" id="hold-signals">0</p>
                                    </div>
                                    <div class="text-yellow-200 text-2xl">📊</div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-2xl text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-blue-100 text-sm">Total Scanned</p>
                                        <p class="text-2xl font-bold" id="total-scanned">0</p>
                                    </div>
                                    <div class="text-blue-200 text-2xl">🔍</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Live Positions Tab -->
                <div id="positions-tab" class="tab-content hidden">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-xl text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">Total Positions</p>
                                    <p class="text-2xl font-bold">15</p>
                                </div>
                                <div class="text-blue-200 text-2xl">🎯</div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-green-500 to-green-600 p-4 rounded-xl text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">Total P&L</p>
                                    <p class="text-2xl font-bold">+₹45,670</p>
                                </div>
                                <div class="text-green-200 text-2xl">📈</div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-4 rounded-xl text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-sm">Capital Used</p>
                                    <p class="text-2xl font-bold">₹4,76,000</p>
                                </div>
                                <div class="text-purple-200 text-2xl">💰</div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-orange-500 to-orange-600 p-4 rounded-xl text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-orange-100 text-sm">Trailing SL Active</p>
                                    <p class="text-2xl font-bold">12</p>
                                </div>
                                <div class="text-orange-200 text-2xl">🛡️</div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-2xl shadow-lg border">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold flex items-center">
                                📈 Live Positions (15)
                                <span class="ml-2 w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                            </h3>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b bg-gray-50">
                                        <th class="text-left py-3 px-2">Symbol</th>
                                        <th class="text-center py-3 px-2">Strategy</th>
                                        <th class="text-center py-3 px-2">Type</th>
                                        <th class="text-right py-3 px-2">Qty</th>
                                        <th class="text-right py-3 px-2">Entry</th>
                                        <th class="text-right py-3 px-2">LTP</th>
                                        <th class="text-right py-3 px-2">P&L</th>
                                        <th class="text-center py-3 px-2">SL Status</th>
                                        <th class="text-center py-3 px-2">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="positions-table-body">
                                    <!-- Positions will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Trade Reports Tab -->
                <div id="trades-tab" class="tab-content hidden">
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-xl text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">Total Trades</p>
                                    <p class="text-2xl font-bold">5</p>
                                </div>
                                <div class="text-blue-200 text-2xl">📊</div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-green-500 to-green-600 p-4 rounded-xl text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">Profitable</p>
                                    <p class="text-2xl font-bold">4</p>
                                </div>
                                <div class="text-green-200 text-2xl">📈</div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-red-500 to-red-600 p-4 rounded-xl text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-red-100 text-sm">Loss Trades</p>
                                    <p class="text-2xl font-bold">1</p>
                                </div>
                                <div class="text-red-200 text-2xl">📉</div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-4 rounded-xl text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-sm">Win Rate</p>
                                    <p class="text-2xl font-bold">80%</p>
                                </div>
                                <div class="text-purple-200 text-2xl">🏆</div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-teal-500 to-teal-600 p-4 rounded-xl text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-teal-100 text-sm">Total P&L</p>
                                    <p class="text-2xl font-bold">+₹2,748</p>
                                </div>
                                <div class="text-teal-200 text-2xl">💰</div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-2xl shadow-lg border">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold flex items-center">
                                📋 Trade Execution Reports
                                <span class="ml-2 w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                            </h3>
                            <div class="flex space-x-2">
                                <button onclick="generateReport('excel')" class="px-3 py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700 transition-all">
                                    📊 Excel Report
                                </button>
                                <button onclick="generateReport('pdf')" class="px-3 py-2 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700 transition-all">
                                    📄 PDF Report
                                </button>
                                <button onclick="generateReport('jpeg')" class="px-3 py-2 bg-purple-600 text-white rounded-lg text-sm hover:bg-purple-700 transition-all">
                                    📸 JPEG Image
                                </button>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b bg-gray-50">
                                        <th class="text-left py-3 px-2">Trade ID</th>
                                        <th class="text-left py-3 px-2">Symbol</th>
                                        <th class="text-center py-3 px-2">Type</th>
                                        <th class="text-right py-3 px-2">Entry</th>
                                        <th class="text-right py-3 px-2">Exit</th>
                                        <th class="text-right py-3 px-2">Qty</th>
                                        <th class="text-right py-3 px-2">P&L</th>
                                        <th class="text-center py-3 px-2">Mode</th>
                                        <th class="text-left py-3 px-2">Strategy</th>
                                    </tr>
                                </thead>
                                <tbody id="trades-table-body">
                                    <!-- Trades will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- AI Strategies Tab -->
                <div id="strategies-tab" class="tab-content hidden">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-r from-green-500 to-green-600 p-4 rounded-xl text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">Active Strategies</p>
                                    <p class="text-2xl font-bold">6/7</p>
                                </div>
                                <div class="text-green-200 text-2xl">🧠</div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-xl text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">Today's Trades</p>
                                    <p class="text-2xl font-bold">54</p>
                                </div>
                                <div class="text-blue-200 text-2xl">📊</div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-4 rounded-xl text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-sm">Total Capital</p>
                                    <p class="text-2xl font-bold">₹30,50,000</p>
                                </div>
                                <div class="text-purple-200 text-2xl">💰</div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-orange-500 to-orange-600 p-4 rounded-xl text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-orange-100 text-sm">Avg Performance</p>
                                    <p class="text-2xl font-bold">+31.2%</p>
                                </div>
                                <div class="text-orange-200 text-2xl">🏆</div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6" id="strategies-container">
                        <!-- Strategies will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Broker Setup Tab -->
                <div id="brokers-tab" class="tab-content hidden">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="text-xl font-semibold flex items-center">
                                    🔌 Complete Zerodha Kite Connect Setup
                                    <span class="ml-2 px-2 py-1 bg-green-100 text-green-700 rounded-lg text-sm animate-pulse" id="connection-status-badge">
                                        ✅ Connected & Live
                                    </span>
                                </h3>
                                <p class="text-gray-600 text-sm">Professional API integration with full authentication</p>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-6 rounded-xl space-y-6">
                            <!-- Setup Progress -->
                            <div class="bg-white p-4 rounded-lg">
                                <h4 class="font-medium mb-3">🎯 Setup Progress</h4>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div class="p-3 rounded-lg text-center bg-green-100 text-green-700" id="step-api-key">
                                        <div class="text-2xl mb-2">🔑</div>
                                        <p class="text-sm font-medium">API Key</p>
                                        <div class="text-green-600 mt-1">✓</div>
                                    </div>
                                    <div class="p-3 rounded-lg text-center bg-green-100 text-green-700" id="step-secret-key">
                                        <div class="text-2xl mb-2">🔐</div>
                                        <p class="text-sm font-medium">Secret Key</p>
                                        <div class="text-green-600 mt-1">✓</div>
                                    </div>
                                    <div class="p-3 rounded-lg text-center bg-green-100 text-green-700" id="step-token">
                                        <div class="text-2xl mb-2">🔓</div>
                                        <p class="text-sm font-medium">Access Token</p>
                                        <div class="text-green-600 mt-1">✓</div>
                                    </div>
                                    <div class="p-3 rounded-lg text-center bg-green-100 text-green-700" id="step-permissions">
                                        <div class="text-2xl mb-2">✅</div>
                                        <p class="text-sm font-medium">Permissions</p>
                                        <div class="text-green-600 mt-1">✓</div>
                                    </div>
                                </div>
                            </div>

                            <!-- API Configuration -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">🔑 Zerodha API Key *</label>
                                    <div class="relative">
                                        <input
                                            type="text"
                                            id="api-key-input"
                                            placeholder="Enter your Zerodha API Key"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                            value="kite_api_key_123456"
                                        />
                                        <div class="absolute right-3 top-2.5 text-green-600">✓</div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">🔐 Secret Key *</label>
                                    <div class="relative">
                                        <input
                                            type="password"
                                            id="secret-key-input"
                                            placeholder="Enter your Secret Key"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                            value="secret_key_hidden"
                                        />
                                        <div class="absolute right-3 top-2.5 text-green-600">✓</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Token Management -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">🎫 Access Token Generation & Daily Management</label>
                                <div class="space-y-3">
                                    <div class="flex space-x-2">
                                        <input
                                            type="text"
                                            id="access-token-input"
                                            readonly
                                            placeholder="Access token will be generated automatically"
                                            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-100"
                                            value="kite_api_123456_78901234"
                                        />
                                        <button onclick="fetch('/api/zerodha/generate_token').then(r => r.json()).then(data => console.log(data))" class="px-6 py-2 rounded-lg font-medium transition-all bg-green-600 text-white hover:bg-green-700">
                                            🔑 Generate Token
                                        </button>
                                        <button onclick="saveZerodhaConfig()" class="px-6 py-2 rounded-lg font-medium transition-all bg-blue-600 text-white hover:bg-blue-700">
                                            💾 Save Config
                                        </button>
                                    </div>
                                    
                                    <div class="flex space-x-2">
                                        <button onclick="fetch('/api/token/refresh').then(r => r.json()).then(data => console.log('Token Refreshed'))" class="flex-1 px-4 py-2 rounded-lg font-medium transition-all bg-blue-600 text-white hover:bg-blue-700">
                                            🔄 Daily Token Refresh
                                        </button>
                                        <button onclick="saveAllSettings()" class="flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-medium transition-all">
                                            💾 Save All Settings
                                        </button>
                                        <button onclick="loadSettings()" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium transition-all">
                                            📥 Load Settings
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Connection Success -->
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                <div class="flex items-center mb-3">
                                    <div class="text-green-600 mr-2">✅</div>
                                    <h4 class="font-medium text-green-800">Connection Successful!</h4>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                    <div>
                                        <p class="text-green-700 font-medium">Status</p>
                                        <p class="text-green-600">Connected & Active</p>
                                    </div>
                                    <div>
                                        <p class="text-green-700 font-medium">Trading</p>
                                        <p class="text-green-600">Enabled</p>
                                    </div>
                                    <div>
                                        <p class="text-green-700 font-medium">Last Login</p>
                                        <p class="text-green-600 text-xs" id="last-login-time">Today, 09:15 AM</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Paper Trading Settings -->
                    <div class="bg-white p-6 rounded-2xl shadow-lg border mt-6">
                        <h3 class="text-lg font-semibold mb-4">📄 Paper Trading Capital Management</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">💰 Total Paper Trading Capital</label>
                                    <input
                                        type="number"
                                        id="paper-capital-input"
                                        value="1000000"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                            </div>

                            <div class="p-4 bg-yellow-50 rounded-lg">
                                <h4 class="font-medium text-yellow-800 mb-3">📊 Paper Trading Statistics</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span>Used Capital:</span>
                                        <span class="font-medium">₹45,000</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Available Capital:</span>
                                        <span class="font-medium">₹9,55,000</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Current P&L:</span>
                                        <span class="font-medium text-green-600">+₹12,500</span>
                                    </div>
                                </div>
                                <button onclick="resetPaperTrading()" class="w-full mt-3 px-3 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-all">
                                    🔄 Reset Portfolio
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Notifications Panel -->
        <div id="notifications-panel" class="fixed top-20 right-4 w-80 bg-white rounded-lg shadow-xl border z-50 max-h-96 overflow-y-auto hidden">
            <div class="p-3 border-b">
                <h3 class="font-semibold">🔔 Live Notifications</h3>
            </div>
            <div class="divide-y" id="notifications-container">
                <div class="p-3 hover:bg-gray-50 border-l-4 border-green-500">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <p class="text-sm">✅ Zerodha API Connected Successfully!</p>
                            <p class="text-xs text-gray-500 mt-1">09:15:32</p>
                        </div>
                        <button onclick="closeNotification(this)" class="text-gray-400 hover:text-gray-600">×</button>
                    </div>
                </div>
                <div class="p-3 hover:bg-gray-50 border-l-4 border-blue-500">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <p class="text-sm">📊 Auto-Save: All settings saved successfully!</p>
                            <p class="text-xs text-gray-500 mt-1">09:14:45</p>
                        </div>
                        <button onclick="closeNotification(this)" class="text-gray-400 hover:text-gray-600">×</button>
                    </div>
                </div>
                <div class="p-3 hover:bg-gray-50 border-l-4 border-yellow-500">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <p class="text-sm">📡 Market scanner activated - Auto-refresh every 1 minute</p>
                            <p class="text-xs text-gray-500 mt-1">09:13:20</p>
                        </div>
                        <button onclick="closeNotification(this)" class="text-gray-400 hover:text-gray-600">×</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let activeTab = 'dashboard';
        let isPaperTrading = true;
        let isAutoTrading = false;
        let zerodhaConnected = true;
        let scannerInterval = null;

        // Stock data
        const allStocks = [
            { symbol: 'RELIANCE', name: 'Reliance Industries Ltd', price: 2478.30, change: 1.37, sector: 'Energy', volume: 1234567 },
            { symbol: 'TCS', name: 'Tata Consultancy Services', price: 3812.45, change: 0.61, sector: 'IT', volume: 987654 },
            { symbol: 'HDFCBANK', name: 'HDFC Bank Ltd', price: 1698.75, change: 0.64, sector: 'Banking', volume: 2345678 },
            { symbol: 'INFY', name: 'Infosys Ltd', price: 1789.90, change: 2.14, sector: 'IT', volume: 1567890 },
            { symbol: 'ICICIBANK', name: 'ICICI Bank Ltd', price: 1167.25, change: -0.25, sector: 'Banking', volume: 3456789 },
            { symbol: 'WIPRO', name: 'Wipro Ltd', price: 567.89, change: 1.78, sector: 'IT', volume: 3210987 },
            { symbol: 'SBIN', name: 'State Bank of India', price: 823.45, change: 1.89, sector: 'Banking', volume: 5678901 },
            { symbol: 'BHARTIARTL', name: 'Bharti Airtel Ltd', price: 1234.56, change: 0.94, sector: 'Telecom', volume: 2109876 },
            { symbol: 'ITC', name: 'ITC Ltd', price: 456.75, change: -0.87, sector: 'FMCG', volume: 4567890 },
            { symbol: 'LT', name: 'Larsen & Toubro Ltd', price: 3456.78, change: 1.56, sector: 'Construction', volume: 765432 },
            { symbol: 'BAJFINANCE', name: 'Bajaj Finance Ltd', price: 6789.34, change: 2.15, sector: 'NBFC', volume: 987123 },
            { symbol: 'AXISBANK', name: 'Axis Bank Ltd', price: 1123.45, change: -0.45, sector: 'Banking', volume: 2876543 },
            { symbol: 'MARUTI', name: 'Maruti Suzuki India Ltd', price: 12345.67, change: 1.45, sector: 'Auto', volume: 543210 },
            { symbol: 'ASIANPAINT', name: 'Asian Paints Ltd', price: 2987.65, change: 0.76, sector: 'Paints', volume: 654321 },
            { symbol: 'NESTLEIND', name: 'Nestle India Ltd', price: 23456.78, change: 0.89, sector: 'FMCG', volume: 123456 }
        ];

        // Positions data
        const positions = [
            { symbol: "RELIANCE", strategy: "Sector Rotation", type: "EQUITY", shares: 100, avgPrice: 2456.75, currentPrice: 2478.30, trailingSL: true },
            { symbol: "TCS", strategy: "Monthly Trend", type: "EQUITY", shares: 50, avgPrice: 3789.20, currentPrice: 3812.45, trailingSL: true },
            { symbol: "BANKNIFTY25JUL47000CE", strategy: "Bank Nifty Scalping", type: "OPTIONS", shares: 25, avgPrice: 185.50, currentPrice: 198.25, trailingSL: true },
            { symbol: "HDFCBANK", strategy: "VWAP Reversal", type: "EQUITY", shares: 75, avgPrice: 1687.90, currentPrice: 1698.75, trailingSL: true },
            { symbol: "NIFTY25JUL24500PE", strategy: "Weekly Options", type: "OPTIONS", shares: 50, avgPrice: 156.30, currentPrice: 142.80, trailingSL: false },
            { symbol: "ICICIBANK", strategy: "Sector Rotation", type: "EQUITY", shares: 60, avgPrice: 1156.75, currentPrice: 1167.25, trailingSL: true },
            { symbol: "INFY", strategy: "AI Sector ML", type: "EQUITY", shares: 40, avgPrice: 1789.90, currentPrice: 1798.45, trailingSL: true },
            { symbol: "WIPRO", strategy: "IT Momentum", type: "EQUITY", shares: 80, avgPrice: 567.89, currentPrice: 575.20, trailingSL: true },
            { symbol: "NIFTY25JUL24600CE", strategy: "Opening Range", type: "OPTIONS", shares: 75, avgPrice: 134.50, currentPrice: 142.80, trailingSL: true },
            { symbol: "AXISBANK", strategy: "Banking Rally", type: "EQUITY", shares: 90, avgPrice: 1123.45, currentPrice: 1134.60, trailingSL: true },
            { symbol: "BAJFINANCE", strategy: "NBFC Growth", type: "EQUITY", shares: 15, avgPrice: 6789.34, currentPrice: 6823.50, trailingSL: true },
            { symbol: "BANKNIFTY25JUL46500PE", strategy: "Put Hedge", type: "OPTIONS", shares: 50, avgPrice: 167.30, currentPrice: 158.40, trailingSL: false },
            { symbol: "SBIN", strategy: "PSU Banking", type: "EQUITY", shares: 120, avgPrice: 823.45, currentPrice: 835.60, trailingSL: true },
            { symbol: "ITC", strategy: "FMCG Defensive", type: "EQUITY", shares: 200, avgPrice: 456.75, currentPrice: 465.80, trailingSL: true },
            { symbol: "FINNIFTY25JUL19800CE", strategy: "Options Greeks", type: "OPTIONS", shares: 40, avgPrice: 89.75, currentPrice: 95.30, trailingSL: true }
        ];

        // Trades data
        const trades = [
            { id: "T001", symbol: "NIFTY25JUL24500CE", type: "BUY", entry: "167.50", exit: "189.25", qty: 50, pnl: "1087.50", mode: "LIVE", strategy: "Opening Range" },
            { id: "T002", symbol: "BANKNIFTY25JUL47000PE", type: "SELL", entry: "234.75", exit: "198.50", qty: 25, pnl: "906.25", mode: "PAPER", strategy: "Scalping Bot" },
            { id: "T003", symbol: "RELIANCE", type: "BUY", entry: "2445.30", exit: "2478.90", qty: 10, pnl: "336.00", mode: "LIVE", strategy: "Sector Rotation" },
            { id: "T004", symbol: "TCS", type: "BUY", entry: "3789.20", exit: "3812.45", qty: 25, pnl: "581.25", mode: "LIVE", strategy: "Monthly Trend" },
            { id: "T005", symbol: "HDFCBANK", type: "SELL", entry: "1687.90", exit: "1698.75", qty: 15, pnl: "-162.75", mode: "PAPER", strategy: "Mean Reversion" }
        ];

        // Strategies data
        const strategies = [
            { id: 1, name: "Nifty Opening Range Breakout", status: "active", performance: 28.4, trades: 189, winRate: 73, todayTrades: 12, capital: 200000 },
            { id: 2, name: "Bank Nifty Scalping Bot", status: "active", performance: 45.2, trades: 324, winRate: 68, todayTrades: 28, capital: 300000 },
            { id: 3, name: "VWAP Reversal Strategy", status: "active", performance: 32.1, trades: 156, winRate: 76, todayTrades: 8, capital: 250000 },
            { id: 4, name: "Weekly Options Straddle", status: "active", performance: 38.7, trades: 52, winRate: 71, todayTrades: 3, capital: 400000 },
            { id: 5, name: "Sector Rotation Weekly", status: "active", performance: 29.3, trades: 78, winRate: 74, todayTrades: 2, capital: 500000 },
            { id: 6, name: "Monthly Trend Following", status: "active", performance: 24.6, trades: 24, winRate: 78, todayTrades: 1, capital: 600000 },
            { id: 7, name: "Monthly Options Selling", status: "paused", performance: 21.4, trades: 36, winRate: 82, todayTrades: 0, capital: 800000 }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            populatePopularStocks();
            fetch('/api/positions').then(r => r.json()).then(data => console.log(data)); populatePositionsTable();
            fetch('/api/trades').then(r => r.json()).then(data => console.log(data)); populateTradesTable();
            populateStrategiesContainer();
        });

        function updateTime() {
            document.getElementById('current-time').textContent = new Date().toLocaleTimeString();
        }

        function setActiveTab(tabId) {
            // Update active tab
            activeTab = tabId;
            
            // Update navigation
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.className = 'tab-button flex items-center px-3 py-4 text-sm font-medium border-b-2 transition-all whitespace-nowrap text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300';
            });
            document.querySelector(`[data-tab="${tabId}"]`).className = 'tab-button flex items-center px-3 py-4 text-sm font-medium border-b-2 transition-all whitespace-nowrap text-blue-600 border-blue-600 bg-blue-50';
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tabId}-tab`).classList.remove('hidden');
            
            // Special handling for scanner tab
            if (tabId === 'scanner') {
                document.getElementById('scanner-indicator').style.display = 'block';
                startScannerAutoRefresh();
                showNotification('info', '📡 Market scanner activated - Auto-refresh every 1 minute');
            } else {
                document.getElementById('scanner-indicator').style.display = 'none';
                stopScannerAutoRefresh();
            }

            // Special handling for stock search tab
            if (tabId === 'stocksearch') {
                showNotification('info', '🔍 Stock search ready - Search by symbol or company name');
            }
        }

        function toggleNotifications() {
            const panel = document.getElementById('notifications-panel');
            panel.classList.toggle('hidden');
        }

        function toggleTradingMode() {
            isPaperTrading = !isPaperTrading;
            const btn = document.getElementById('trading-mode-btn');
            const badge = document.getElementById('trading-mode');
            const text = document.getElementById('trading-mode-text');
            
            if (isPaperTrading) {
                btn.textContent = '📄 Paper Mode';
                btn.className = 'px-4 py-2 rounded-xl font-medium transition-all bg-yellow-500 hover:bg-yellow-600';
                badge.textContent = '📄 Paper Mode';
                badge.className = 'px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800';
                text.textContent = 'Currently in Paper Trading mode - ₹10,00,000 virtual capital.';
            } else {
                btn.textContent = '💰 Live Mode';
                btn.className = 'px-4 py-2 rounded-xl font-medium transition-all bg-green-500 hover:bg-green-600';
                badge.textContent = '💰 Live Mode';
                badge.className = 'px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800';
                text.textContent = 'Live trading active with real money.';
            }
            
            showNotification('info', `📋 Switched to ${isPaperTrading ? 'Paper' : 'Live'} Trading Mode`);
        }

        function toggleAutoTrading() {
            isAutoTrading = !isAutoTrading;
            const btn = document.getElementById('auto-trading-btn');
            
            if (isAutoTrading) {
                btn.textContent = '⏸️ Stop AI';
                btn.className = 'px-6 py-2 rounded-xl font-medium transition-all transform hover:scale-105 bg-red-500 hover:bg-red-600 shadow-lg';
                showNotification('success', '🤖 AI Trading Started');
            } else {
                btn.textContent = '▶️ Start AI';
                btn.className = 'px-6 py-2 rounded-xl font-medium transition-all transform hover:scale-105 bg-green-500 hover:bg-green-600 shadow-lg';
                showNotification('warning', '🤖 AI Trading Stopped');
            }
        }

        function searchStocks() {
            const query = document.getElementById('stock-search-input').value.toLowerCase();
            const resultsContainer = document.getElementById('search-results-container');
            const resultsDiv = document.getElementById('stock-search-results');
            
            if (query.length === 0) {
                resultsDiv.classList.add('hidden');
                return;
            }
            
            const filtered = allStocks.filter(stock => 
                stock.symbol.toLowerCase().includes(query) ||
                stock.name.toLowerCase().includes(query)
            );
            
            if (filtered.length > 0) {
                resultsDiv.classList.remove('hidden');
                resultsContainer.innerHTML = filtered.map(stock => `
                    <div class="p-4 border rounded-lg hover:bg-gray-50 transition-all">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div>
                                    <h5 class="font-medium text-lg">${stock.symbol}</h5>
                                    <p class="text-sm text-gray-600">${stock.name}</p>
                                    <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">${stock.sector}</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-lg font-bold">₹${stock.price.toFixed(2)}</p>
                                <p class="text-sm font-medium ${stock.change >= 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${stock.change >= 0 ? '+' : ''}${stock.change.toFixed(2)}%
                                </p>
                                <div class="flex space-x-2 mt-2">
                                    <button onclick="buyStock('${stock.symbol}')" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700 transition-all">Buy</button>
                                    <button onclick="sellStock('${stock.symbol}')" class="px-3 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700 transition-all">Sell</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                resultsDiv.classList.add('hidden');
            }
        }

        function clearStockSearch() {
            document.getElementById('stock-search-input').value = '';
            document.getElementById('stock-search-results').classList.add('hidden');
            showNotification('info', '🔄 Stock search cleared');
        }

        function populatePopularStocks() {
            const container = document.getElementById('popular-stocks');
            const popularSymbols = ['RELIANCE', 'TCS', 'HDFCBANK', 'INFY', 'ICICIBANK', 'WIPRO'];
            
            container.innerHTML = popularSymbols.map(symbol => {
                const stock = allStocks.find(s => s.symbol === symbol);
                return `
                    <button onclick="searchPopularStock('${symbol}')" class="p-3 border rounded-lg text-center hover:bg-blue-50 hover:border-blue-300 transition-all">
                        <div class="font-medium">${symbol}</div>
                        <div class="text-sm">₹${stock.price.toFixed(2)}</div>
                        <div class="text-xs ${stock.change >= 0 ? 'text-green-600' : 'text-red-600'}">
                            ${stock.change >= 0 ? '+' : ''}${stock.change.toFixed(2)}%
                        </div>
                    </button>
                `;
            }).join('');
        }

        function searchPopularStock(symbol) {
            document.getElementById('stock-search-input').value = symbol;
            searchStocks();
        }

        function buyStock(symbol) {
            fetch('/api/order/place', {method: 'POST', body: JSON.stringify({symbol})}).then(() => showNotification('success', `📈 Buy order placed for ${symbol}`));
        }

        function sellStock(symbol) {
            fetch('/api/order/place', {method: 'POST', body: JSON.stringify({symbol, side: 'SELL'})}).then(() => showNotification('warning', `📉 Sell order placed for ${symbol}`));
        }

        function startScannerAutoRefresh() {
            fetch('/api/scanner').then(r => r.json()).then(data => console.log(data)); refreshScanner(); // Initial scan
            scannerInterval = setInterval(refreshScanner, 60000); // Every 1 minute
        }

        function stopScannerAutoRefresh() {
            if (scannerInterval) {
                clearInterval(scannerInterval);
                scannerInterval = null;
            }
        }

        function refreshScanner() {
            const scannedStocks = allStocks.map(stock => ({
                ...stock,
                price: stock.price + (Math.random() - 0.5) * 20,
                change: stock.change + (Math.random() - 0.5) * 2,
                volume: Math.floor(Math.random() * 10000000) + 1000000,
                rsi: Math.floor(Math.random() * 100),
                signal: Math.random() > 0.7 ? 'BUY' : Math.random() > 0.4 ? 'HOLD' : 'SELL',
                score: Math.floor(Math.random() * 100)
            })).sort((a, b) => b.score - a.score).slice(0, 15);
            
            document.getElementById('last-scan-time').textContent = new Date().toLocaleTimeString();
            
            // Update statistics
            const buySignals = scannedStocks.filter(s => s.signal === 'BUY').length;
            const sellSignals = scannedStocks.filter(s => s.signal === 'SELL').length;
            const holdSignals = scannedStocks.filter(s => s.signal === 'HOLD').length;
            
            document.getElementById('buy-signals').textContent = buySignals;
            document.getElementById('sell-signals').textContent = sellSignals;
            document.getElementById('hold-signals').textContent = holdSignals;
            document.getElementById('total-scanned').textContent = scannedStocks.length;
            
            // Update table
            const tableHTML = `
                <table class="w-full">
                    <thead>
                        <tr class="border-b bg-gray-50">
                            <th class="text-left py-3 px-2">Rank</th>
                            <th class="text-left py-3 px-2">Symbol</th>
                            <th class="text-center py-3 px-2">Signal</th>
                            <th class="text-right py-3 px-2">Price</th>
                            <th class="text-right py-3 px-2">Change %</th>
                            <th class="text-right py-3 px-2">Volume</th>
                            <th class="text-right py-3 px-2">RSI</th>
                            <th class="text-right py-3 px-2">Score</th>
                            <th class="text-center py-3 px-2">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${scannedStocks.map((stock, index) => `
                            <tr class="border-b hover:bg-gray-50">
                                <td class="py-3 px-2 font-medium">#${index + 1}</td>
                                <td class="py-3 px-2 font-medium">${stock.symbol}</td>
                                <td class="text-center py-3 px-2">
                                    <span class="px-2 py-1 rounded text-xs font-medium ${
                                        stock.signal === 'BUY' ? 'bg-green-100 text-green-700' :
                                        stock.signal === 'SELL' ? 'bg-red-100 text-red-700' :
                                        'bg-yellow-100 text-yellow-700'
                                    }">
                                        ${stock.signal}
                                    </span>
                                </td>
                                <td class="text-right py-3 px-2">₹${stock.price.toFixed(2)}</td>
                                <td class="text-right py-3 px-2 font-medium ${stock.change >= 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${stock.change >= 0 ? '+' : ''}${stock.change.toFixed(2)}%
                                </td>
                                <td class="text-right py-3 px-2 text-sm">${stock.volume.toLocaleString()}</td>
                                <td class="text-right py-3 px-2">
                                    <span class="font-medium ${
                                        stock.rsi > 70 ? 'text-red-600' :
                                        stock.rsi < 30 ? 'text-green-600' :
                                        'text-gray-700'
                                    }">
                                        ${stock.rsi}
                                    </span>
                                </td>
                                <td class="text-right py-3 px-2 font-bold text-blue-600">${stock.score}/100</td>
                                <td class="text-center py-3 px-2">
                                    <button onclick="buyStock('${stock.symbol}')" class="px-2 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700 transition-all">
                                        Buy
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            document.getElementById('scanner-results').innerHTML = tableHTML;
            
            if (activeTab === 'scanner') {
                showNotification('success', '🔄 Market scanner refreshed manually');
            }
        }

        function populatePositionsTable() {
            const tbody = document.getElementById('positions-table-body');
            tbody.innerHTML = positions.map(pos => {
                const pl = (pos.currentPrice - pos.avgPrice) * pos.shares;
                const plPercent = ((pos.currentPrice - pos.avgPrice) / pos.avgPrice) * 100;
                return `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="py-3 px-2 font-medium">${pos.symbol}</td>
                        <td class="text-center py-3 px-2">
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">${pos.strategy}</span>
                        </td>
                        <td class="text-center py-3 px-2">
                            <span class="px-2 py-1 rounded text-xs font-medium ${
                                pos.type === 'OPTIONS' ? 'bg-purple-100 text-purple-700' : 'bg-green-100 text-green-700'
                            }">
                                ${pos.type}
                            </span>
                        </td>
                        <td class="text-right py-3 px-2">${pos.shares}</td>
                        <td class="text-right py-3 px-2">₹${pos.avgPrice.toFixed(2)}</td>
                        <td class="text-right py-3 px-2 font-medium">₹${pos.currentPrice.toFixed(2)}</td>
                        <td class="text-right py-3 px-2 font-medium ${pl >= 0 ? 'text-green-600' : 'text-red-600'}">
                            ${pl >= 0 ? '+' : ''}₹${pl.toFixed(2)}<br>
                            <span class="text-xs">(${plPercent >= 0 ? '+' : ''}${plPercent.toFixed(2)}%)</span>
                        </td>
                        <td class="text-center py-3 px-2">
                            ${pos.trailingSL ? 
                                '<span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">Active</span>' :
                                '<span class="px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs">Disabled</span>'
                            }
                        </td>
                        <td class="text-center py-3 px-2">
                            <button onclick="exitPosition('${pos.symbol}')" class="px-2 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700 transition-all">Exit</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function populateTradesTable() {
            const tbody = document.getElementById('trades-table-body');
            tbody.innerHTML = trades.map(trade => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="py-3 px-2 text-sm font-mono">${trade.id}</td>
                    <td class="py-3 px-2 font-medium">${trade.symbol}</td>
                    <td class="text-center py-3 px-2">
                        <span class="px-2 py-1 rounded text-xs font-medium ${
                            trade.type === 'BUY' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'
                        }">
                            ${trade.type}
                        </span>
                    </td>
                    <td class="text-right py-3 px-2">₹${trade.entry}</td>
                    <td class="text-right py-3 px-2">₹${trade.exit}</td>
                    <td class="text-right py-3 px-2">${trade.qty}</td>
                    <td class="text-right py-3 px-2 font-medium ${
                        parseFloat(trade.pnl) >= 0 ? 'text-green-600' : 'text-red-600'
                    }">
                        ${parseFloat(trade.pnl) >= 0 ? '+' : ''}₹${trade.pnl}
                    </td>
                    <td class="text-center py-3 px-2">
                        <span class="px-2 py-1 rounded text-xs font-medium ${
                            trade.mode === 'PAPER' ? 'bg-yellow-100 text-yellow-700' : 'bg-blue-100 text-blue-700'
                        }">
                            ${trade.mode}
                        </span>
                    </td>
                    <td class="py-3 px-2 text-sm">${trade.strategy}</td>
                </tr>
            `).join('');
        }

        function populateStrategiesContainer() {
            const container = document.getElementById('strategies-container');
            container.innerHTML = strategies.map(strategy => `
                <div class="bg-white p-6 rounded-2xl shadow-lg border hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 rounded-full ${
                                strategy.status === 'active' ? 'bg-green-500 animate-pulse' : 'bg-gray-400'
                            }"></div>
                            <h4 class="text-lg font-semibold">${strategy.name}</h4>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-medium ${
                            strategy.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'
                        }">
                            ${strategy.status.toUpperCase()}
                        </span>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 mb-4">
                        <div class="text-center p-3 bg-gray-50 rounded-lg">
                            <p class="text-xs text-gray-500">Performance</p>
                            <p class="font-bold text-green-600">+${strategy.performance}%</p>
                        </div>
                        <div class="text-center p-3 bg-gray-50 rounded-lg">
                            <p class="text-xs text-gray-500">Win Rate</p>
                            <p class="font-bold">${strategy.winRate}%</p>
                        </div>
                        <div class="text-center p-3 bg-gray-50 rounded-lg">
                            <p class="text-xs text-gray-500">Trades</p>
                            <p class="font-bold text-blue-600">${strategy.trades}</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <p class="text-xs text-gray-500">Capital Allocated</p>
                            <p class="font-medium">₹${strategy.capital.toLocaleString()}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500">Today's Trades</p>
                            <p class="font-medium text-blue-600">${strategy.todayTrades}</p>
                        </div>
                    </div>

                    <div class="flex space-x-2">
                        <button onclick="toggleStrategy(${strategy.id})" class="flex-1 py-2 px-4 rounded-lg font-medium transition-all ${
                            strategy.status === 'active' 
                                ? 'bg-yellow-600 text-white hover:bg-yellow-700' 
                                : 'bg-green-600 text-white hover:bg-green-700'
                        }">
                            ${strategy.status === 'active' ? '⏸️ Pause' : '▶️ Activate'}
                        </button>
                        <button onclick="viewStrategyReport(${strategy.id})" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-all">
                            📊 Reports
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function exitPosition(symbol) {
            showNotification('success', `📤 ${symbol} position manually squared off`);
        }

        function toggleStrategy(strategyId) {
            const strategy = strategies.find(s => s.id === strategyId);
            if (strategy) {
                strategy.status = strategy.status === 'active' ? 'paused' : 'active';
                populateStrategiesContainer();
                showNotification(
                    strategy.status === 'active' ? 'success' : 'warning',
                    `${strategy.name} ${strategy.status === 'active' ? 'Activated' : 'Paused'}`
                );
            }
        }

        function viewStrategyReport(strategyId) {
            const strategy = strategies.find(s => s.id === strategyId);
            showNotification('info', `📊 ${strategy.name} performance report generated`);
        }

        function generateReport(format) {
            const formatNames = {
                'excel': 'Excel',
                'pdf': 'PDF',
                'jpeg': 'JPEG'
            };
            
            const fileName = `Trading_Report_${new Date().toISOString().split('T')[0]}.${format === 'excel' ? 'xlsx' : format}`;
            showNotification('success', `📊 ${formatNames[format]} Report Generated: ${fileName}`);
        }

        function fetch('/api/zerodha/generate_token').then(r => r.json()).then(data => console.log(data)) {
            document.getElementById('access-token-input').value = `kite_api_${Date.now().toString().slice(-8)}`;
            showNotification('success', '✅ Access token generated successfully!');
        }

        function saveZerodhaConfig() {
            showNotification('success', '✅ Zerodha API configuration saved successfully!');
        }

        function fetch('/api/token/refresh').then(r => r.json()).then(data => console.log('Token Refreshed')) {
            document.getElementById('access-token-input').value = `kite_api_${Date.now().toString().slice(-8)}`;
            document.getElementById('last-login-time').textContent = new Date().toLocaleString();
            showNotification('success', '🔄 Daily access token refreshed successfully!');
        }

        function saveAllSettings() {
            showNotification('success', '💾 All settings saved successfully!');
        }

        function loadSettings() {
            showNotification('success', '📥 Settings loaded successfully!');
        }

        function resetPaperTrading() {
            showNotification('success', '🔄 Paper Trading Reset Complete | Capital: ₹10,00,000');
        }

        function emergencyStop() {
            showNotification('warning', '🛑 EMERGENCY STOP: All trading halted and positions closed');
        }

        function closeLivePositions() {
            showNotification('warning', '⏹️ All live positions closed');
        }

        function createBackup() {
            showNotification('success', '💾 Emergency backup created');
        }

        function showNotification(type, message) {
            const container = document.getElementById('notifications-container');
            const colors = {
                'success': 'border-green-500',
                'warning': 'border-yellow-500',
                'error': 'border-red-500',
                'info': 'border-blue-500'
            };
            
            const notification = document.createElement('div');
            notification.className = `p-3 hover:bg-gray-50 border-l-4 ${colors[type]} notification-enter`;
            notification.innerHTML = `
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <p class="text-sm">${message}</p>
                        <p class="text-xs text-gray-500 mt-1">${new Date().toLocaleTimeString()}</p>
                    </div>
                    <button onclick="closeNotification(this)" class="text-gray-400 hover:text-gray-600">×</button>
                </div>
            `;
            
            container.insertBefore(notification, container.firstChild);
            
            // Remove old notifications (keep only last 10)
            while (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
            
            // Auto-remove success notifications after 5 seconds
            if (type === 'success') {
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 5000);
            }
        }

        function closeNotification(button) {
            button.closest('.p-3').remove();
        }
    </script>
</body>
</html>